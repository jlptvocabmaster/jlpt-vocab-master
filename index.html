<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—¥æœ¬èª JLPT Vocab Master</title>
<meta name="description" content="Learn Japanese JLPT vocabulary the anime way. Free forever â€” quiz, flashcards, and memory hooks for N5 to N1.">
<meta property="og:title" content="ğŸ‡¯ğŸ‡µ JLPT Vocabulary Master">
<meta property="og:description" content="Learn Japanese the anime way. Quiz mode, flashcards, memory hooks â€” always free for N5 to N1.">
<meta property="og:image" content="https://placehold.co/1200x630/1a1a2e/c0392b?text=%E6%97%A5%E6%9C%AC%E8%AA%9E+JLPT+Vocab+Master">
<meta property="og:type" content="website">
<meta property="og:url" content="https://yourdomain.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="ğŸ‡¯ğŸ‡µ JLPT Vocabulary Master">
<meta name="twitter:description" content="Learn Japanese the anime way. Free forever â€” quiz, flashcards, N5 to N1.">
<meta name="twitter:image" content="https://placehold.co/1200x630/1a1a2e/c0392b?text=%E6%97%A5%E6%9C%AC%E8%AA%9E+JLPT+Vocab+Master">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
:root {
  --crimson: #c0392b;
  --crimson-dk: #922b21;
  --crimson-lt: #fadbd8;
  --gold: #d4ac0d;
  --gold-lt: #fef9e7;
  --ink: #1a1a2e;
  --paper: #fdf6ec;
  --stone: #7f8c8d;
  --border: #e8ddd0;
  --white: #ffffff;
  --n5: #27ae60; --n4: #2980b9; --n3: #8e44ad; --n2: #e67e22; --n1: #c0392b;
  --radius: 16px;
  --shadow: 0 8px 40px rgba(0,0,0,0.12);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Noto Sans JP', sans-serif; background: var(--paper); min-height: 100vh; color: var(--ink); overflow-x: hidden; }

/* Washi texture */
body::before { content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E"); opacity: 0.5; }

/* Floating kanji canvas */
#kanjiCanvas { position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.045; }

/* Radial glow centre */
body::after { content: ''; position: fixed; top: 30%; left: 50%; transform: translate(-50%,-50%); width: 600px; height: 600px; background: radial-gradient(circle, rgba(192,57,43,0.07) 0%, transparent 70%); pointer-events: none; z-index: 0; border-radius: 50%; }

.stripe { position: fixed; top: 0; left: 0; bottom: 0; width: 6px; background: linear-gradient(180deg, var(--crimson), #e74c3c, var(--gold), var(--crimson)); z-index: 10; }

/* Welcome back banner */
.welcome-back {
  display: none;
  background: linear-gradient(135deg, var(--ink), #2c3e50);
  border-radius: var(--radius); padding: 16px 18px;
  margin-bottom: 20px; position: relative; overflow: hidden;
  animation: fadeUp .5s ease both;
}
.welcome-back.show { display: flex; align-items: center; gap: 14px; }
.welcome-back::before { content: ''; position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: radial-gradient(circle, rgba(212,172,13,0.3), transparent); border-radius: 50%; }
.wb-emoji { font-size: 2rem; flex-shrink: 0; }
.wb-text { flex: 1; }
.wb-title { font-family: 'DM Serif Display', serif; font-size: 1rem; color: var(--gold); margin-bottom: 3px; }
.wb-sub { font-size: 0.75rem; color: #94a3b8; line-height: 1.4; }
.wb-streak { font-family: 'DM Serif Display', serif; font-size: 1.4rem; color: var(--gold); flex-shrink: 0; }

/* Level stat rows inside cards */
.level-stats { margin-top: 8px; width: 100%; }
.level-stat-bar { height: 4px; background: #e8ddd0; border-radius: 99px; overflow: hidden; margin-top: 4px; margin-bottom: 3px; }
.level-stat-fill { height: 100%; border-radius: 99px; transition: width 1s ease; }
.level-card[data-level="N5"] .level-stat-fill { background: var(--n5); }
.level-card[data-level="N4"] .level-stat-fill { background: var(--n4); }
.level-card[data-level="N3"] .level-stat-fill { background: var(--n3); }
.level-card[data-level="N2"] .level-stat-fill { background: var(--n2); }
.level-card[data-level="N1"] .level-stat-fill { background: var(--n1); }
.level-stat-label { font-size: 0.6rem; color: var(--stone); display: flex; justify-content: space-between; }

/* Continue session banner */
.continue-bar {
  display: none; background: var(--gold-lt); border: 1.5px solid var(--gold);
  border-radius: 14px; padding: 14px 16px; margin-bottom: 20px;
  animation: fadeUp .4s ease both;
}
.continue-bar.show { display: flex; align-items: center; gap: 12px; }
.continue-bar-text { flex: 1; }
.continue-bar-title { font-weight: 700; font-size: 0.88rem; color: var(--ink); margin-bottom: 2px; }
.continue-bar-sub { font-size: 0.72rem; color: var(--stone); }
.continue-btn { background: var(--gold); color: var(--ink); border: none; border-radius: 10px; padding: 9px 16px; font-family: 'DM Serif Display', serif; font-size: 0.9rem; cursor: pointer; white-space: nowrap; transition: transform .18s; flex-shrink: 0; }
.continue-btn:hover { transform: translateY(-2px); }
.wrapper { position: relative; z-index: 1; max-width: 680px; margin: 0 auto; padding: 0 20px 110px; }

/* Support floating button */
.support-float {
  position: fixed; bottom: 62px; right: 20px; z-index: 50;
  background: var(--gold); color: var(--ink); border: none;
  border-radius: 99px; padding: 10px 18px;
  font-family: 'Noto Sans JP', sans-serif; font-size: 0.82rem; font-weight: 700;
  cursor: pointer; box-shadow: 0 4px 20px rgba(212,172,13,0.45);
  transition: transform .2s, box-shadow .2s;
  text-decoration: none; display: flex; align-items: center; gap: 6px;
}
.support-float:hover { transform: translateY(-3px); box-shadow: 0 8px 28px rgba(212,172,13,0.55); }

/* SCREENS */
.screen { display: none; }
.screen.active { display: block; animation: fadeUp .4s ease both; }
@keyframes fadeUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:none; } }

/* â”€â”€ HOME â”€â”€ */
.home-header { text-align: center; padding: 40px 0 24px; border-bottom: 2px solid var(--border); margin-bottom: 28px; }
.jp-title { font-family: 'Noto Serif JP', serif; font-size: clamp(2rem,8vw,3.4rem); color: var(--crimson); letter-spacing: 6px; line-height: 1.2; margin-bottom: 4px; }
.en-title { font-family: 'DM Serif Display', serif; font-size: clamp(0.9rem,3vw,1.15rem); color: var(--stone); letter-spacing: 3px; text-transform: uppercase; }

/* Anime quote card */
.quote-card {
  background: var(--ink); border-radius: var(--radius); padding: 20px 22px;
  margin-bottom: 28px; position: relative; overflow: hidden;
}
.quote-card::before { content: 'ã€Œ'; position: absolute; top: -10px; left: 10px; font-family: 'Noto Serif JP', serif; font-size: 5rem; color: var(--crimson); opacity: 0.2; line-height: 1; pointer-events: none; }
.quote-jp { font-family: 'Noto Serif JP', serif; font-size: 1rem; color: #e2e8f0; line-height: 1.7; margin-bottom: 6px; }
.quote-en { font-size: 0.78rem; color: #94a3b8; font-style: italic; margin-bottom: 8px; line-height: 1.5; }
.quote-source { font-size: 0.68rem; color: var(--gold); font-weight: 700; letter-spacing: 1px; }
.quote-tag { font-size: 0.62rem; color: #475569; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; font-weight: 700; }

.section-label { font-size: 0.7rem; font-weight: 700; letter-spacing: 2.5px; text-transform: uppercase; color: var(--stone); margin-bottom: 12px; padding-left: 2px; }

/* Level grid */
.level-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 11px; margin-bottom: 28px; }
.level-card { background: var(--white); border: 2px solid var(--border); border-radius: var(--radius); padding: 16px 14px; cursor: pointer; text-align: center; transition: all .2s ease; position: relative; overflow: hidden; }
.level-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
.level-card[data-level="N5"]::before{background:var(--n5)}.level-card[data-level="N4"]::before{background:var(--n4)}.level-card[data-level="N3"]::before{background:var(--n3)}.level-card[data-level="N2"]::before{background:var(--n2)}.level-card[data-level="N1"]::before{background:var(--n1)}
.level-card:hover { transform: translateY(-3px); box-shadow: var(--shadow); }
.level-card.selected { border-width: 2.5px; }
.level-card[data-level="N5"].selected{border-color:var(--n5);background:#eafaf1}.level-card[data-level="N4"].selected{border-color:var(--n4);background:#eaf4fb}.level-card[data-level="N3"].selected{border-color:var(--n3);background:#f5eef8}.level-card[data-level="N2"].selected{border-color:var(--n2);background:#fef5e7}.level-card[data-level="N1"].selected{border-color:var(--n1);background:#fdedec}
.level-kanji { font-family: 'Noto Serif JP', serif; font-size: 1.7rem; font-weight: 700; margin-bottom: 2px; }
.level-card[data-level="N5"] .level-kanji{color:var(--n5)}.level-card[data-level="N4"] .level-kanji{color:var(--n4)}.level-card[data-level="N3"] .level-kanji{color:var(--n3)}.level-card[data-level="N2"] .level-kanji{color:var(--n2)}.level-card[data-level="N1"] .level-kanji{color:var(--n1)}
.level-rank { font-size: 0.68rem; font-weight: 700; color: var(--stone); margin-bottom: 3px; letter-spacing: 1px; }
.level-desc { font-size: 0.7rem; color: var(--stone); }
.level-free { font-size: 0.62rem; color: var(--n5); font-weight: 700; margin-top: 4px; }

/* Mode pills */
.mode-row { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
.mode-pill { padding: 9px 14px; background: var(--white); border: 2px solid var(--border); border-radius: 99px; font-size: 0.82rem; font-weight: 700; cursor: pointer; transition: all .18s; color: var(--ink); }
.mode-pill:hover { border-color: var(--crimson); color: var(--crimson); }
.mode-pill.sel { background: var(--crimson); color: white; border-color: var(--crimson); }

.start-btn { width: 100%; padding: 17px; background: var(--crimson); border: none; border-radius: var(--radius); font-family: 'DM Serif Display', serif; font-size: 1.35rem; letter-spacing: 2px; color: white; cursor: pointer; box-shadow: 0 4px 20px rgba(192,57,43,.35); transition: transform .2s, box-shadow .2s; }
.start-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 32px rgba(192,57,43,.45); }

/* â”€â”€ GAME HEADER â”€â”€ */
.game-top { display: flex; align-items: center; justify-content: space-between; padding: 18px 0 12px; border-bottom: 1px solid var(--border); margin-bottom: 18px; position: sticky; top: 0; background: var(--paper); z-index: 5; }
.gt-left { display: flex; flex-direction: column; gap: 2px; }
.gt-level { font-family: 'Noto Serif JP', serif; font-size: 1.1rem; font-weight: 700; }
.gt-rank { font-size: 0.68rem; color: var(--stone); font-weight: 700; letter-spacing: 1px; }
.gt-right { text-align: right; }
.gt-score { font-size: 0.88rem; font-weight: 700; color: var(--gold); }
.gt-lives { font-size: 1rem; letter-spacing: 2px; }
.prog-bar-wrap { height: 6px; background: var(--border); border-radius: 99px; overflow: hidden; margin-bottom: 20px; }
.prog-bar-fill { height: 100%; border-radius: 99px; transition: width .5s cubic-bezier(.4,0,.2,1); }

/* â”€â”€ QUIZ CARD â”€â”€ */
.q-card { background: var(--white); border: 1.5px solid var(--border); border-radius: 20px; padding: 26px 22px 20px; box-shadow: 0 4px 24px rgba(0,0,0,.06); }
.q-tag { display: inline-block; background: var(--crimson-lt); color: var(--crimson); font-size: 0.65rem; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; border-radius: 6px; padding: 3px 9px; margin-bottom: 14px; }
.word-header { position: relative; text-align: center; margin-bottom: 18px; }
.kanji-display { font-family: 'Noto Serif JP', serif; font-size: clamp(2rem,9vw,3.2rem); font-weight: 700; color: var(--ink); line-height: 1.2; margin-bottom: 4px; }
.furigana-display { font-size: 0.88rem; color: var(--stone); margin-bottom: 3px; }
.romaji-display { font-size: 0.78rem; color: #aaa; font-style: italic; }
.origin-btn {
  position: absolute; top: 0; right: 0;
  background: none; border: 2px solid var(--border);
  border-radius: 10px; padding: 6px 10px; cursor: pointer;
  font-size: 1rem; color: var(--stone);
  transition: all .18s; line-height: 1;
}
.origin-btn:hover { border-color: var(--gold); background: var(--gold-lt); transform: scale(1.1); }

.opts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; }
.opt-btn { background: #f8f6f2; border: 2px solid var(--border); border-radius: 12px; padding: 12px 10px; font-family: 'Noto Sans JP', sans-serif; font-size: 0.86rem; font-weight: 700; color: var(--ink); cursor: pointer; text-align: center; line-height: 1.4; transition: all .16s ease; }
.opt-btn:hover:not(:disabled) { border-color: var(--crimson); background: var(--crimson-lt); transform: translateY(-2px); }
.opt-btn.correct { border-color: #27ae60; background: #eafaf1; color: #1e8449; animation: pulse .35s ease; }
.opt-btn.wrong { border-color: var(--crimson); background: var(--crimson-lt); color: var(--crimson-dk); animation: jolt .3s ease; }
@keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.04)} }
@keyframes jolt { 0%,100%{transform:translateX(0)} 30%{transform:translateX(-6px)} 70%{transform:translateX(6px)} }

.fill-wrap { display: flex; flex-direction: column; gap: 9px; }
.fill-inp { width: 100%; padding: 12px 14px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Noto Sans JP', sans-serif; font-size: 1rem; font-weight: 600; color: var(--ink); background: #f8f6f2; outline: none; transition: border-color .2s; }
.fill-inp:focus { border-color: var(--crimson); background: white; }
.fill-inp.correct { border-color: #27ae60; background: #eafaf1; }
.fill-inp.wrong { border-color: var(--crimson); background: var(--crimson-lt); }
.fill-sub { padding: 12px; background: var(--crimson); color: white; border: none; border-radius: 12px; font-family: 'DM Serif Display', serif; font-size: 1.05rem; letter-spacing: 1px; cursor: pointer; transition: transform .18s; }
.fill-sub:hover { transform: translateY(-2px); }

.flashcard-scene { perspective: 1000px; width: 100%; cursor: pointer; margin-bottom: 12px; }
.flashcard { width: 100%; min-height: 180px; position: relative; transform-style: preserve-3d; transition: transform .6s cubic-bezier(.4,0,.2,1); border-radius: 20px; }
.flashcard.flipped { transform: rotateY(180deg); }
.card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 26px 22px; border: 1.5px solid var(--border); background: var(--white); box-shadow: 0 4px 24px rgba(0,0,0,.06); }
.card-back { transform: rotateY(180deg); background: var(--ink); border-color: var(--ink); color: white; }
.flip-hint { font-size: 0.68rem; color: var(--stone); letter-spacing: 1px; margin-top: 10px; }
.flashcard-btns { display: flex; gap: 10px; margin-top: 6px; }
.fc-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-family: 'DM Serif Display', serif; font-size: 0.9rem; cursor: pointer; transition: transform .18s; }
.fc-btn:hover { transform: translateY(-2px); }
.fc-got { background: #eafaf1; color: #1e8449; border: 2px solid #27ae60; }
.fc-miss { background: var(--crimson-lt); color: var(--crimson); border: 2px solid var(--crimson); }

/* Anime sensei wrong answer quote */
.sensei-quote { margin-top: 10px; background: var(--ink); border-radius: 12px; padding: 12px 14px; display: none; }
.sensei-quote.show { display: block; animation: fadeUp .3s ease; }
.sensei-text { font-size: 0.78rem; color: #94a3b8; font-style: italic; line-height: 1.5; }
.sensei-src { font-size: 0.65rem; color: var(--gold); margin-top: 4px; font-weight: 700; }

.feedback { margin-top: 12px; padding: 11px 14px; border-radius: 12px; font-weight: 600; font-size: 0.86rem; display: none; line-height: 1.5; gap: 6px; align-items: flex-start; }
.feedback.show { display: flex; animation: fadeUp .3s ease; }
.feedback.good { background: #eafaf1; color: #1e8449; }
.feedback.bad { background: var(--crimson-lt); color: var(--crimson-dk); }
.next-btn { width: 100%; margin-top: 10px; padding: 13px; background: var(--ink); border: none; border-radius: 12px; color: white; font-family: 'DM Serif Display', serif; font-size: 1.05rem; letter-spacing: 1px; cursor: pointer; display: none; transition: background .2s, transform .2s; }
.next-btn:hover { background: var(--crimson); transform: translateY(-2px); }
.next-btn.show { display: block; animation: fadeUp .3s .1s both; }

/* â”€â”€ ORIGIN PANEL â”€â”€ */
.panel-overlay { display: none; position: fixed; inset: 0; background: rgba(26,26,46,0.65); backdrop-filter: blur(4px); z-index: 200; align-items: flex-end; justify-content: center; padding: 0; }
.panel-overlay.show { display: flex; animation: fadeUp .3s ease; }
.origin-panel {
  background: var(--white); border-radius: 24px 24px 0 0; width: 100%; max-width: 680px;
  padding: 28px 24px 40px; max-height: 85vh; overflow-y: auto;
  animation: slideUp .35s cubic-bezier(.4,0,.2,1) both;
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
.panel-handle { width: 40px; height: 4px; background: var(--border); border-radius: 99px; margin: 0 auto 20px; }
.panel-word { font-family: 'Noto Serif JP', serif; font-size: 2rem; font-weight: 700; color: var(--crimson); text-align: center; margin-bottom: 4px; }
.panel-reading { font-size: 0.85rem; color: var(--stone); text-align: center; margin-bottom: 20px; }
.panel-close { position: absolute; top: 16px; right: 20px; background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--stone); }
.origin-section { margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid var(--border); }
.origin-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.origin-section-title { font-size: 0.65rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--crimson); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
.origin-section-body { font-size: 0.88rem; color: var(--ink); line-height: 1.7; }
.origin-section-body strong { color: var(--crimson); }
.radical-pills { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.radical-pill { background: #f8f6f2; border: 1.5px solid var(--border); border-radius: 10px; padding: 6px 12px; font-size: 0.82rem; }
.radical-pill .rp-kanji { font-family: 'Noto Serif JP', serif; font-size: 1.1rem; color: var(--crimson); display: block; text-align: center; }
.radical-pill .rp-mean { font-size: 0.65rem; color: var(--stone); display: block; text-align: center; margin-top: 2px; }
.related-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.related-chip { background: var(--crimson-lt); border-radius: 8px; padding: 5px 10px; font-size: 0.82rem; color: var(--crimson-dk); font-family: 'Noto Serif JP', serif; }

/* â”€â”€ MODALS â”€â”€ */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(26,26,46,0.72); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
.modal-overlay.show { display: flex; animation: fadeUp .3s ease; }
.modal-box { background: var(--white); border-radius: 24px; padding: 34px 26px; max-width: 420px; width: 100%; text-align: center; position: relative; box-shadow: 0 24px 80px rgba(0,0,0,.25); }
.modal-icon { font-size: 3rem; margin-bottom: 10px; }
.modal-title { font-family: 'DM Serif Display', serif; font-size: 1.5rem; color: var(--ink); margin-bottom: 8px; }
.modal-sub { font-size: 0.86rem; color: var(--stone); margin-bottom: 22px; line-height: 1.6; }
.modal-btn { width: 100%; padding: 14px; background: var(--crimson); border: none; border-radius: 12px; color: white; font-family: 'DM Serif Display', serif; font-size: 1.1rem; cursor: pointer; transition: transform .18s; margin-bottom: 10px; display: block; text-decoration: none; }
.modal-btn:hover { transform: translateY(-2px); }
.modal-btn-gold { background: var(--gold); color: var(--ink); }
.modal-dismiss { font-size: 0.78rem; color: var(--stone); cursor: pointer; text-decoration: underline; display: block; }
.modal-dismiss:hover { color: var(--crimson); }

/* Email form */
.email-form { display: flex; flex-direction: column; gap: 9px; margin-bottom: 14px; }
.email-inp { width: 100%; padding: 12px 14px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Noto Sans JP', sans-serif; font-size: 0.95rem; color: var(--ink); outline: none; transition: border-color .2s; }
.email-inp:focus { border-color: var(--crimson); }

/* â”€â”€ SCORE â”€â”€ */
.score-wrap { background: var(--white); border-radius: 20px; padding: 34px 22px; text-align: center; box-shadow: var(--shadow); margin-top: 20px; }
.score-jp { font-family: 'Noto Serif JP', serif; font-size: 2.4rem; color: var(--crimson); margin-bottom: 4px; }
.score-en { font-family: 'DM Serif Display', serif; font-size: 1.45rem; color: var(--ink); margin-bottom: 8px; }
.score-num { font-family: 'DM Serif Display', serif; font-size: 3rem; color: var(--crimson); line-height: 1; }
.score-denom { font-size: 1rem; color: var(--stone); margin-bottom: 4px; }
.score-sub { font-size: 0.86rem; color: var(--stone); margin-bottom: 20px; }
.dots-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-bottom: 20px; }
.dot { width: 23px; height: 23px; border-radius: 50%; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; }
.dot.hit { background: #eafaf1; } .dot.miss { background: var(--crimson-lt); }
.score-actions { display: flex; gap: 10px; }
.sc-btn { flex: 1; padding: 13px; border-radius: 12px; border: none; font-family: 'DM Serif Display', serif; font-size: 0.95rem; letter-spacing: 1px; cursor: pointer; transition: transform .18s; }
.sc-btn:hover { transform: translateY(-2px); }
.sc-home { background: #f1f5f9; color: var(--ink); }
.sc-again { background: var(--crimson); color: white; }

/* Score anime quote */
.score-quote { background: var(--ink); border-radius: 14px; padding: 16px 18px; margin-bottom: 20px; text-align: left; }
.sq-label { font-size: 0.6rem; color: var(--gold); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 6px; }
.sq-jp { font-family: 'Noto Serif JP', serif; font-size: 0.9rem; color: #e2e8f0; line-height: 1.6; margin-bottom: 4px; }
.sq-en { font-size: 0.75rem; color: #94a3b8; font-style: italic; margin-bottom: 4px; }
.sq-src { font-size: 0.62rem; color: var(--gold); font-weight: 700; }

/* â”€â”€ XP & STREAK HUD â”€â”€ */
.xp-hud {
  display: flex; align-items: center; gap: 10px;
  background: var(--ink); border-radius: 12px; padding: 8px 14px;
  margin-bottom: 14px; position: sticky; top: 62px; z-index: 4;
}
.xp-bar-wrap { flex: 1; }
.xp-bar-label { display: flex; justify-content: space-between; font-size: 0.62rem; color: #94a3b8; font-weight: 700; letter-spacing: 1px; margin-bottom: 4px; }
.xp-bar-track { height: 5px; background: #2c3e50; border-radius: 99px; overflow: hidden; }
.xp-bar-fill { height: 100%; border-radius: 99px; background: linear-gradient(90deg, var(--gold), #f39c12); transition: width 0.6s cubic-bezier(.4,0,.2,1); }
.xp-streak { font-size: 0.9rem; font-weight: 700; color: var(--gold); white-space: nowrap; flex-shrink: 0; }
.xp-rank-badge { font-size: 0.7rem; font-weight: 700; color: var(--gold); flex-shrink: 0; letter-spacing: 1px; }

/* XP pop float animation */
.xp-pop {
  position: fixed; pointer-events: none; z-index: 999;
  font-family: 'DM Serif Display', serif; font-size: 1.1rem;
  font-weight: 700; color: var(--gold);
  text-shadow: 0 2px 8px rgba(0,0,0,0.4);
  animation: xpFloat 1.2s ease forwards;
}
@keyframes xpFloat {
  0%   { opacity: 1; transform: translateY(0) scale(1); }
  60%  { opacity: 1; transform: translateY(-40px) scale(1.2); }
  100% { opacity: 0; transform: translateY(-70px) scale(0.9); }
}

/* Level-up toast */
.levelup-toast {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: linear-gradient(135deg, var(--gold), #f39c12);
  color: var(--ink); border-radius: 99px; padding: 10px 22px;
  font-family: 'DM Serif Display', serif; font-size: 1rem; font-weight: 700;
  box-shadow: 0 8px 32px rgba(212,172,13,0.5); z-index: 1000;
  animation: toastIn .4s ease, toastOut .4s ease 2.2s forwards;
  white-space: nowrap;
}
@keyframes toastIn { from { opacity:0; transform:translateX(-50%) translateY(-20px); } to { opacity:1; transform:translateX(-50%) translateY(0); } }
@keyframes toastOut { to { opacity:0; transform:translateX(-50%) translateY(-20px); } }

/* Score XP summary */
.score-xp-summary { background: linear-gradient(135deg, var(--ink), #2c3e50); border-radius: 14px; padding: 16px 18px; margin-bottom: 18px; display: flex; align-items: center; gap: 14px; }
.sxp-icon { font-size: 2rem; flex-shrink: 0; }
.sxp-text { flex: 1; }
.sxp-title { font-family: 'DM Serif Display', serif; font-size: 1rem; color: var(--gold); margin-bottom: 2px; }
.sxp-sub { font-size: 0.75rem; color: #94a3b8; }
.sxp-total { font-family: 'DM Serif Display', serif; font-size: 1.4rem; color: var(--gold); flex-shrink: 0; }
.share-app-btn {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  width: 100%; padding: 11px; margin-bottom: 24px;
  background: var(--white); border: 2px dashed var(--border); border-radius: var(--radius);
  font-family: 'Noto Sans JP', sans-serif; font-size: 0.82rem; font-weight: 700;
  color: var(--stone); cursor: pointer; transition: all .2s;
}
.share-app-btn:hover { border-color: var(--crimson); color: var(--crimson); background: var(--crimson-lt); }

.sc-share { background: #f0fdf4; color: #166534; border: 2px solid #86efac; flex: 1; }

.share-word-btn {
  display: inline-flex; align-items: center; gap: 5px;
  background: none; border: 1.5px solid var(--border);
  border-radius: 8px; padding: 5px 10px; cursor: pointer;
  font-size: 0.72rem; font-weight: 700; color: var(--stone);
  transition: all .18s; margin-top: 10px;
}
.share-word-btn:hover { border-color: var(--gold); color: var(--gold); background: var(--gold-lt); }

/* Share modal */
.share-modal-box { background: var(--white); border-radius: 24px; padding: 28px 22px; max-width: 380px; width: 100%; text-align: center; position: relative; box-shadow: 0 24px 80px rgba(0,0,0,.25); }
.share-title { font-family: 'DM Serif Display', serif; font-size: 1.25rem; color: var(--ink); margin-bottom: 6px; }
.share-text-preview { background: #f8f6f2; border: 1.5px solid var(--border); border-radius: 10px; padding: 12px 14px; font-size: 0.82rem; color: var(--stone); margin-bottom: 16px; line-height: 1.6; text-align: left; }
.share-socials { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; margin-bottom: 12px; }
.share-soc-btn { padding: 11px 8px; border: none; border-radius: 10px; font-size: 0.8rem; font-weight: 700; cursor: pointer; transition: transform .16s, opacity .16s; display: flex; align-items: center; justify-content: center; gap: 6px; }
.share-soc-btn:hover { transform: translateY(-2px); opacity: 0.9; }
.soc-twitter { background: #000; color: white; }
.soc-whatsapp { background: #25d366; color: white; }
.soc-facebook { background: #1877f2; color: white; }
.soc-linkedin { background: #0a66c2; color: white; }
.copy-link-btn { width: 100%; padding: 11px; background: #f8f6f2; border: 1.5px solid var(--border); border-radius: 10px; font-family: 'Noto Sans JP', sans-serif; font-size: 0.82rem; font-weight: 700; color: var(--stone); cursor: pointer; transition: all .18s; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 6px; }
.copy-link-btn:hover { border-color: var(--crimson); color: var(--crimson); }
.copy-link-btn.copied { border-color: #27ae60; color: #27ae60; background: #eafaf1; }

/* â”€â”€ SOCIAL FOOTER BAR â”€â”€ */
.social-footer {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 40;
  background: #0f0f1a; border-top: 1px solid #1e2a3a;
  display: flex; align-items: stretch; height: 50px;
}
.sf-label {
  display: flex; align-items: center; padding: 0 12px;
  font-size: 0.52rem; color: #475569; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase;
  border-right: 1px solid #1e2a3a; white-space: nowrap; flex-shrink: 0;
}
.sf-btn {
  flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px;
  border: none; background: transparent; cursor: pointer;
  font-size: 0.65rem; font-weight: 700; color: #64748b;
  border-right: 1px solid #1e2a3a; transition: background .15s, color .15s;
  text-decoration: none;
}
.sf-btn:last-child { border-right: none; }
.sf-tw:hover  { background: rgba(255,255,255,0.06); color: #e2e8f0; }
.sf-wa:hover  { background: rgba(37,211,102,0.12); color: #25d366; }
.sf-fb:hover  { background: rgba(24,119,242,0.12); color: #60a5fa; }
.sf-rd:hover  { background: rgba(255,69,0,0.12); color: #ff6b35; }
.sf-li:hover  { background: rgba(10,102,194,0.12); color: #60a5fa; }
</style>
</head>
<body>
<div class="stripe"></div>
<canvas id="kanjiCanvas"></canvas>

<!-- Floating support button -->
<a id="supportBtn" href="https://4655550918506.gumroad.com/coffee" target="_blank" class="support-float">
  â­ Say arigatou â€” â‚¹99
</a>

<div class="wrapper">

<!-- â”€â”€ HOME â”€â”€ -->
<div class="screen active" id="homeScreen">
  <div class="home-header">
    <div class="jp-title">æ—¥æœ¬èª å˜èª</div>
    <div class="en-title">JLPT Vocabulary Master Â· Always Free</div>
  </div>

  <!-- Welcome back banner -->
  <div class="welcome-back" id="welcomeBack">
    <div class="wb-emoji">ğŸ‘‹</div>
    <div class="wb-text">
      <div class="wb-title" id="wbTitle">Welcome back, Sensei!</div>
      <div class="wb-sub" id="wbSub"></div>
    </div>
    <div class="wb-streak" id="wbStreak"></div>
  </div>

  <!-- Continue session bar -->
  <div class="continue-bar" id="continueBar">
    <div class="continue-bar-text">
      <div class="continue-bar-title" id="cbTitle">ğŸ“š Continue where you left off</div>
      <div class="continue-bar-sub" id="cbSub"></div>
    </div>
    <button class="continue-btn" onclick="continueSession()">Resume â†’</button>
  </div>

  <div class="quote-card" id="homeQuote">
    <div class="quote-tag">ğŸŒ Today's Anime Wisdom</div>
    <div class="quote-jp" id="homeQuoteJP"></div>
    <div class="quote-en" id="homeQuoteEN"></div>
    <div class="quote-source" id="homeQuoteSRC"></div>
  </div>

  <div class="section-label">Choose Your Level</div>
  <div class="level-grid">
    <div class="level-card selected" data-level="N5" onclick="selectLevel(this)">
      <div class="level-kanji">N5</div>
      <div class="level-rank">ğŸ¥‹ GENIN</div>
      <div class="level-desc">Complete Beginner</div>
      <div class="level-stats">
        <div class="level-stat-bar"><div class="level-stat-fill" id="bar-N5" style="width:0%"></div></div>
        <div class="level-stat-label"><span id="seen-N5">0 studied</span><span>50 words</span></div>
      </div>
      <div class="level-free">ğŸ Always Open</div>
    </div>
    <div class="level-card" data-level="N4" onclick="selectLevel(this)">
      <div class="level-kanji">N4</div>
      <div class="level-rank">âš”ï¸ CHUNIN</div>
      <div class="level-desc">Elementary</div>
      <div class="level-stats">
        <div class="level-stat-bar"><div class="level-stat-fill" id="bar-N4" style="width:0%"></div></div>
        <div class="level-stat-label"><span id="seen-N4">0 studied</span><span>50 words</span></div>
      </div>
      <div class="level-free">ğŸ Always Open</div>
    </div>
    <div class="level-card" data-level="N3" onclick="selectLevel(this)">
      <div class="level-kanji">N3</div>
      <div class="level-rank">ğŸ—¡ï¸ JONIN</div>
      <div class="level-desc">Intermediate</div>
      <div class="level-stats">
        <div class="level-stat-bar"><div class="level-stat-fill" id="bar-N3" style="width:0%"></div></div>
        <div class="level-stat-label"><span id="seen-N3">0 studied</span><span>50 words</span></div>
      </div>
      <div class="level-free">ğŸ Always Open</div>
    </div>
    <div class="level-card" data-level="N2" onclick="selectLevel(this)">
      <div class="level-kanji">N2</div>
      <div class="level-rank">ğŸ‘ï¸ ANBU</div>
      <div class="level-desc">Upper Intermediate</div>
      <div class="level-stats">
        <div class="level-stat-bar"><div class="level-stat-fill" id="bar-N2" style="width:0%"></div></div>
        <div class="level-stat-label"><span id="seen-N2">0 studied</span><span>50 words</span></div>
      </div>
      <div class="level-free">ğŸ Always Open</div>
    </div>
    <div class="level-card" style="grid-column:span 2" data-level="N1" onclick="selectLevel(this)">
      <div class="level-kanji">N1</div>
      <div class="level-rank">ğŸŒŸ KAGE</div>
      <div class="level-desc">Advanced / Native Level</div>
      <div class="level-stats">
        <div class="level-stat-bar"><div class="level-stat-fill" id="bar-N1" style="width:0%"></div></div>
        <div class="level-stat-label"><span id="seen-N1">0 studied</span><span>50 words</span></div>
      </div>
      <div class="level-free">ğŸ Always Open</div>
    </div>
  </div>

  <div class="section-label">Game Mode</div>
  <div class="mode-row">
    <button class="mode-pill sel" data-mode="meaning" onclick="selectMode(this)">ğŸ¯ Meaning</button>
    <button class="mode-pill" data-mode="reading" onclick="selectMode(this)">ğŸ“– Reading</button>
    <button class="mode-pill" data-mode="fill" onclick="selectMode(this)">âœï¸ Type It</button>
    <button class="mode-pill" data-mode="flash" onclick="selectMode(this)">ğŸƒ Flashcard</button>
  </div>

  <button class="start-btn" onclick="startGame()">å§‹ã‚ã¾ã—ã‚‡ã† â€” Let's Begin â†’</button>

  <button class="share-app-btn" onclick="shareApp()" style="margin-top:12px">
    ğŸ”— Share This App with a Friend
  </button>
</div>

<!-- â”€â”€ GAME SCREEN â”€â”€ -->
<div class="screen" id="gameScreen">
  <div class="game-top">
    <div class="gt-left">
      <div class="gt-level" id="gtLevel"></div>
      <div class="gt-rank" id="gtRank"></div>
    </div>
    <div class="gt-right">
      <div class="gt-score">â­ <span id="gtScore">0</span></div>
      <div class="gt-lives" id="gtLives"></div>
    </div>
  </div>
  <div class="prog-bar-wrap"><div class="prog-bar-fill" id="progFill" style="width:0%"></div></div>

  <!-- XP + Streak HUD -->
  <div class="xp-hud">
    <div class="xp-rank-badge" id="xpRankBadge">ğŸ¥‹</div>
    <div class="xp-bar-wrap">
      <div class="xp-bar-label">
        <span id="xpRankName">Genin</span>
        <span id="xpLabel">0 XP</span>
      </div>
      <div class="xp-bar-track"><div class="xp-bar-fill" id="xpBarFill" style="width:0%"></div></div>
    </div>
    <div class="xp-streak" id="xpStreakDisplay">ğŸ”¥0</div>
  </div>
  <div class="q-card" id="qCard">
    <div class="q-tag" id="qTag"></div>
    <div id="answerArea"></div>
    <div class="sensei-quote" id="senseiQuote">
      <div class="sensei-text" id="senseiText"></div>
      <div class="sensei-src" id="senseiSrc"></div>
    </div>
    <div class="feedback" id="feedback"></div>
    <button class="next-btn" id="nextBtn" onclick="nextQ()">Next â†’</button>
  </div>
</div>

<!-- â”€â”€ SCORE SCREEN â”€â”€ -->
<div class="screen" id="scoreScreen">
  <div class="score-wrap">
    <div class="score-jp" id="scoreJP"></div>
    <div class="score-en" id="scoreEN"></div>
    <div class="score-num" id="scoreNum"></div>
    <div class="score-denom" id="scoreDenom"></div>
    <div class="score-sub" id="scoreSub"></div>
    <div class="score-quote" id="scoreQuote">
      <div class="sq-label">ğŸŒ Anime Wisdom</div>
      <div class="sq-jp" id="sqJP"></div>
      <div class="sq-en" id="sqEN"></div>
      <div class="sq-src" id="sqSRC"></div>
    </div>
    <div class="dots-row" id="dotsRow"></div>
    <!-- XP Summary -->
    <div class="score-xp-summary" id="scoreXpSummary">
      <div class="sxp-icon">â­</div>
      <div class="sxp-text">
        <div class="sxp-title" id="sxpTitle">XP Earned This Session</div>
        <div class="sxp-sub" id="sxpSub">Total XP: 0</div>
      </div>
      <div class="sxp-total" id="sxpTotal">+0</div>
    </div>
    <div class="score-actions" style="flex-wrap:wrap;gap:10px">
      <button class="sc-btn sc-home" onclick="goHome()">ğŸ  Home</button>
      <button class="sc-btn sc-share" onclick="shareScore()">ğŸ“¤ Share Score</button>
      <button class="sc-btn sc-again" onclick="startGame()" style="flex-basis:100%">ã‚‚ã†ä¸€åº¦ â†’</button>
    </div>
  </div>
</div>

</div><!-- /wrapper -->

<!-- â”€â”€ SOCIAL FOOTER BAR â”€â”€ -->
<nav class="social-footer" aria-label="Share on social media">
  <span class="sf-label">Share âœ¦</span>
  <button class="sf-btn sf-tw" onclick="shareTo('twitter')" title="Share on X / Twitter">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.74l7.73-8.835L1.254 2.25H8.08l4.259 5.63 5.905-5.63zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
    X / Twitter
  </button>
  <button class="sf-btn sf-wa" onclick="shareTo('whatsapp')" title="Share on WhatsApp">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
    WhatsApp
  </button>
  <button class="sf-btn sf-fb" onclick="shareTo('facebook')" title="Share on Facebook">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
    Facebook
  </button>
  <button class="sf-btn sf-rd" onclick="shareTo('reddit')" title="Share on Reddit">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    Reddit
  </button>
  <button class="sf-btn sf-li" onclick="shareTo('linkedin')" title="Share on LinkedIn">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    LinkedIn
  </button>
</nav>

<!-- â”€â”€ ORIGIN PANEL â”€â”€ -->
<div class="panel-overlay" id="originOverlay" onclick="closeOrigin(event)">
  <div class="origin-panel" id="originPanel" style="position:relative">
    <div class="panel-handle"></div>
    <button class="panel-close" onclick="closeOriginBtn()">âœ•</button>
    <div class="panel-word" id="opWord"></div>
    <div class="panel-reading" id="opReading"></div>

    <div class="origin-section">
      <div class="origin-section-title">ğŸ›ï¸ Kanji Pictograph Origin</div>
      <div class="origin-section-body" id="opPictograph"></div>
    </div>
    <div class="origin-section">
      <div class="origin-section-title">ğŸ§© Radical Breakdown</div>
      <div class="radical-pills" id="opRadicals"></div>
    </div>
    <div class="origin-section">
      <div class="origin-section-title">ğŸ­ Literal / Funny Meaning</div>
      <div class="origin-section-body" id="opLiteral"></div>
    </div>
    <div class="origin-section">
      <div class="origin-section-title">ğŸ“– Memory Hook Story</div>
      <div class="origin-section-body" id="opHook"></div>
    </div>
    <div class="origin-section">
      <div class="origin-section-title">ğŸ”— Related Kanji</div>
      <div class="related-row" id="opRelated"></div>
    </div>
  </div>
</div>

<!-- â”€â”€ SHARE MODAL â”€â”€ -->
<div class="modal-overlay" id="shareModal" onclick="closeShareModal(event)">
  <div class="share-modal-box" onclick="event.stopPropagation()">
    <button class="panel-close" onclick="closeShareModal()" style="position:absolute;top:14px;right:16px">âœ•</button>
    <div style="font-size:2rem;margin-bottom:8px" id="shareModalIcon">ğŸ“¤</div>
    <div class="share-title" id="shareModalTitle">Share Your Score</div>
    <div class="share-text-preview" id="shareTextPreview"></div>
    <div class="share-socials" style="grid-template-columns:1fr 1fr 1fr">
      <button class="share-soc-btn soc-twitter" onclick="shareTo('twitter')">ğ• Twitter</button>
      <button class="share-soc-btn soc-whatsapp" onclick="shareTo('whatsapp')">ğŸ’¬ WhatsApp</button>
      <button class="share-soc-btn soc-facebook" onclick="shareTo('facebook')">f Facebook</button>
      <button class="share-soc-btn" style="background:#ff4500;color:white" onclick="shareTo('reddit')">ğŸ¤– Reddit</button>
      <button class="share-soc-btn soc-linkedin" onclick="shareTo('linkedin')">in LinkedIn</button>
      <button class="share-soc-btn" style="background:#1da1f2;color:white" onclick="copyLink()">ğŸ”— Copy</button>
    </div>
    <button class="copy-link-btn" id="copyLinkBtn" onclick="copyLink()">ğŸ”— Copy Link</button>
    <span class="modal-dismiss" onclick="closeShareModal()">Close</span>
  </div>
</div>

<!-- â”€â”€ EMAIL MODAL â”€â”€ -->
<div class="modal-overlay" id="emailModal">
  <div class="modal-box">
    <div class="modal-icon">ğŸ“¬</div>
    <div class="modal-title">Get JLPT Study Tips</div>
    <div class="modal-sub">Join free â€” get weekly vocab tips, anime study tricks, and exam strategies straight to your inbox.</div>
    <div class="email-form">
      <input class="email-inp" id="emailInp" type="email" placeholder="your@email.com">
      <a href="https://YOUR-MAILCHIMP-LINK-HERE" target="_blank" class="modal-btn" onclick="handleEmailSignup()">Subscribe Free â†’</a>
    </div>
    <span class="modal-dismiss" onclick="closeEmail()">Maybe later</span>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ANIME QUOTES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const animeQuotes = [
  { jp:'è«¦ã‚ãŸã‚‰ãã“ã§è©¦åˆçµ‚äº†ã ã‚ˆã€‚', en:'"If you give up, that\'s where the game ends."', src:'â€” Coach Anzai, Slam Dunk ğŸ€' },
  { jp:'ä¿ºãŒã‚„ã‚‰ãªãã‚ƒã€èª°ãŒã‚„ã‚‹ã€‚', en:'"If I don\'t do it, who will?"', src:'â€” Eren Yeager, Attack on Titan âš”ï¸' },
  { jp:'åŠªåŠ›ã—ãŸè€…ãŒå…¨ã¦å ±ã‚ã‚Œã‚‹ã¨ã¯é™ã‚‰ãªã„ã€‚ã—ã‹ã—ã€æˆåŠŸã—ãŸè€…ã¯çš†ã™ã¹ã‹ã‚‰ãåŠªåŠ›ã—ã¦ã„ã‚‹ã€‚', en:'"Not all who work hard are rewarded â€” but all who succeed have worked hard."', src:'â€” Rock Lee, Naruto ğŸƒ' },
  { jp:'é™ç•Œã‚’è¶…ãˆã‚ã€‚', en:'"Go beyond your limits."', src:'â€” All Might, My Hero Academia ğŸ’ª' },
  { jp:'è‡ªåˆ†ã‚’ä¿¡ã˜ã‚‹ã“ã¨ã€ãã‚ŒãŒä¸€ç•ªå¤§åˆ‡ãªã“ã¨ã ã€‚', en:'"Believing in yourself â€” that\'s what matters most."', src:'â€” Monkey D. Luffy, One Piece ğŸ´â€â˜ ï¸' },
  { jp:'å¤±æ•—ã¯æˆåŠŸã®æ¯ã€‚', en:'"Failure is the mother of success."', src:'â€” Dr. Stone ğŸ§ª' },
  { jp:'ä»Šã‚’ç”Ÿãã‚ã€‚', en:'"Live in this moment."', src:'â€” Sword Art Online âš”ï¸' },
  { jp:'ä»²é–“ã‚’å®ˆã‚‹ãŸã‚ã«å¼·ããªã‚‹ã€‚', en:'"I get stronger to protect those I care about."', src:'â€” Naruto Uzumaki, Naruto ğŸƒ' },
  { jp:'ã©ã‚“ãªå¤¢ã‚‚è«¦ã‚ãªã‘ã‚Œã°å¶ã†ã€‚', en:'"Any dream can come true if you never give up."', src:'â€” Gol D. Roger, One Piece ğŸ´â€â˜ ï¸' },
  { jp:'ææ€–ã‚’ä¹—ã‚Šè¶ŠãˆãŸå…ˆã«ã€æœ¬å½“ã®å¼·ã•ãŒã‚ã‚‹ã€‚', en:'"True strength lies on the other side of fear."', src:'â€” Demon Slayer ğŸ—¡ï¸' },
];

const senseiQuotes = [
  { text:'"It\'s not about talent â€” it\'s about effort." ', src:'â€” All Might ğŸ’ª' },
  { text:'"Failure is just another step on the path to mastery."', src:'â€” Rock Lee ğŸƒ' },
  { text:'"Even I got answers wrong before I became the best."', src:'â€” L, Death Note ğŸ°' },
  { text:'"A true warrior never stops learning."', src:'â€” Kenshin Himura âš”ï¸' },
  { text:'"The only way is forward. Never look back with regret."', src:'â€” Naruto ğŸƒ' },
  { text:'"Every mistake is a lesson wearing a disguise."', src:'â€” Senku, Dr. Stone ğŸ§ª' },
];

const lvlRanks = { N5:'ğŸ¥‹ GENIN', N4:'âš”ï¸ CHUNIN', N3:'ğŸ—¡ï¸ JONIN', N2:'ğŸ‘ï¸ ANBU', N1:'ğŸŒŸ KAGE' };
const lvlColor = { N5:'#27ae60', N4:'#2980b9', N3:'#8e44ad', N2:'#e67e22', N1:'#c0392b' };

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VOCAB + ORIGIN DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const vocab = {
  N5: [
    { k:'æ°´', f:'ã¿ãš', r:'mizu', m:'water', pos:'noun',
      origin:{ pictograph:'æ°´ originally depicted flowing water â€” the three wavy lines in the centre represent streams flowing downward. Ancient oracle bone script shows it as a winding river.', radicals:[{k:'æ°´',m:'water'}], literal:'Looks like water dripping between your fingers ğŸ’§', hook:'Imagine pouring WATER (ã¿ãš) â€” the kanji flows like a river!', related:['æµ·','å·','æ³³'] }},
    { k:'ç«', f:'ã²', r:'hi', m:'fire', pos:'noun',
      origin:{ pictograph:'ç« was drawn as dancing flames rising upward. The two strokes at the bottom are the base of the fire, the top strokes are the flames.', radicals:[{k:'ç«',m:'fire'}], literal:'Looks like a flame with sparks flying up ğŸ”¥', hook:'HI! A FIRE says "hi" when it crackles â€” ã² (hi)!', related:['ç‚','ç‡ƒ','ç„¼'] }},
    { k:'å±±', f:'ã‚„ã¾', r:'yama', m:'mountain', pos:'noun',
      origin:{ pictograph:'å±± is one of the most iconic pictographs â€” three peaks of a mountain range. The tallest peak is in the middle, just like Fuji-san! Used since 3,000 BCE in Chinese script.', radicals:[{k:'å±±',m:'mountain'}], literal:'Three mountain peaks side by side â€” you can literally see the mountains! ğŸ”ï¸', hook:'YAMA-ha motorcycles climb mountains â€” ã‚„ã¾ (yama)!', related:['å²©','å²³','å³°'] }},
    { k:'å·', f:'ã‹ã‚', r:'kawa', m:'river', pos:'noun',
      origin:{ pictograph:'å· shows three streams flowing downward â€” the outer two are the riverbanks, the middle is the main current. You can almost see the river flowing!', radicals:[{k:'å·',m:'river'}], literal:'Three vertical lines = three streams of water flowing down ğŸŒŠ', hook:'A RIVER (ã‹ã‚) has banks on each side â€” just like the outer strokes!', related:['æ°´','æµ·','æµ'] }},
    { k:'é£Ÿã¹ã‚‹', f:'ãŸã¹ã‚‹', r:'taberu', m:'to eat', pos:'verb (ru)',
      origin:{ pictograph:'é£Ÿ shows a person (äºº) bending over a bowl (çš¿) of food. The top part (ğ †¢) represents a lid or roof over the food.', radicals:[{k:'é£Ÿ',m:'eat/food'},{k:'äºº',m:'person'}], literal:'A person hunching over their dinner plate ğŸ±', hook:'TABle + ERU = you eat at the TABLE (ãŸã¹ã‚‹)!', related:['é£²','å‘³','æ–™'] }},
    { k:'é£²ã‚€', f:'ã®ã‚€', r:'nomu', m:'to drink', pos:'verb (u)',
      origin:{ pictograph:'é£² combines é£Ÿ (food/eat) with a mouth opening wide (æ¬  â€” a person yawning/opening mouth). Together: opening your mouth to drink.', radicals:[{k:'é£Ÿ',m:'food'},{k:'æ¬ ',m:'open mouth/lack'}], literal:'Food radical + open mouth = consuming liquid ğŸ¥¤', hook:'NO MU-g â€” you say NO to an empty MUG, you want to drink! ã®ã‚€!', related:['é£Ÿ','é…’','æ°´'] }},
    { k:'è¡Œã', f:'ã„ã', r:'iku', m:'to go', pos:'verb (u)',
      origin:{ pictograph:'è¡Œ originally showed a crossroads (å½³ left + äº right) â€” a person standing at an intersection, ready to GO somewhere.', radicals:[{k:'å½³',m:'step/road'},{k:'äº',m:'road right'}], literal:'Standing at a crossroads â€” which way will you GO? ğŸš¶', hook:'IKU sounds like "I go" â€” I go (ã„ã)!', related:['æ¥','æ­©','å¸°'] }},
    { k:'å¤§ãã„', f:'ãŠãŠãã„', r:'ookii', m:'big / large', pos:'adj (i)',
      origin:{ pictograph:'å¤§ shows a person (äºº) standing with arms and legs spread wide â€” making themselves as BIG as possible! The greatest human gesture of size.', radicals:[{k:'å¤§',m:'big/large'},{k:'äºº',m:'person'}], literal:'A person doing a star jump â€” arms and legs spread = BIG! â­', hook:'OO-KII â€” say "ooh!" when you see something BIG (ãŠãŠãã„)!', related:['å°','å¤ª','å¤©'] }},
    { k:'æ–°ã—ã„', f:'ã‚ãŸã‚‰ã—ã„', r:'atarashii', m:'new', pos:'adj (i)',
      origin:{ pictograph:'æ–° combines æœ¨ (tree) + æ–¤ (axe) + ç«‹ (stand) â€” the image of freshly CUT timber, brand new wood just chopped from a standing tree.', radicals:[{k:'æœ¨',m:'tree'},{k:'æ–¤',m:'axe'}], literal:'Freshly cut wood = brand new! ğŸªµ', hook:'A-TA-RASHI â€” "Ah, that\'s the new one!" (ã‚ãŸã‚‰ã—ã„)!', related:['å¤','åˆ','è‹¥'] }},
    { k:'ä»Šæ—¥', f:'ãã‚‡ã†', r:'kyou', m:'today', pos:'noun',
      origin:{ pictograph:'ä»Š (now) + æ—¥ (sun/day) = TODAY. ä»Š shows something being held now â€” the present moment. æ—¥ is the sun. Put them together: the sun of right now = today!', radicals:[{k:'ä»Š',m:'now'},{k:'æ—¥',m:'sun/day'}], literal:'NOW + SUN = today\'s sun = TODAY â˜€ï¸', hook:'KYOU sounds like "here you go" â€” TODAY I give you today! ãã‚‡ã†!', related:['æ˜æ—¥','æ˜¨æ—¥','æ¯æ—¥'] }},
    { k:'å‹é”', f:'ã¨ã‚‚ã ã¡', r:'tomodachi', m:'friend', pos:'noun',
      origin:{ pictograph:'å‹ shows two hands clasped together â€” two people reaching out to each other in friendship. é” means "to reach/arrive" â€” a friend is someone you reach out to!', radicals:[{k:'å‹',m:'friend'},{k:'é”',m:'reach/plural'}], literal:'Two hands clasped = friendship handshake ğŸ¤', hook:'TOMODACHI â€” "TO-MO-DACHI" â€” Together, More, Dachi (Let\'s go)! Friends go together!', related:['ä»²é–“','å®¶æ—','çŸ¥äºº'] }},
    { k:'å­¦æ ¡', f:'ãŒã£ã“ã†', r:'gakkou', m:'school', pos:'noun',
      origin:{ pictograph:'å­¦ shows a child (å­) under a roof with hands above â€” a child being taught under a roof = learning. æ ¡ adds wood (æœ¨) + the idea of a structure = school building!', radicals:[{k:'å­¦',m:'study/learn'},{k:'æ ¡',m:'school building'}], literal:'Child being taught under a roof ğŸ«', hook:'GAKKOU â€” "GACK! School!" â€” that\'s your reaction Monday morning! ãŒã£ã“ã†!', related:['å¤§å­¦','æ•™å®¤','å…ˆç”Ÿ'] }},
    { k:'å¥½ã', f:'ã™ã', r:'suki', m:'like / fond of', pos:'adj (na)',
      origin:{ pictograph:'å¥½ shows a woman (å¥³) next to a child (å­) â€” a mother\'s love for her child was the original image of LIKING or loving something. Pure affection!', radicals:[{k:'å¥³',m:'woman'},{k:'å­',m:'child'}], literal:'Mother + child = love/like â¤ï¸', hook:'SUKI sounds like "Suckey" â€” the opposite of what you LIKE! But you love suki! ã™ã!', related:['å«Œã„','æ„›','æ‹'] }},
    { k:'ä»Šæ—¥', f:'ãã‚‡ã†', r:'kyou', m:'today', pos:'noun',
      origin:{ pictograph:'ä»Š (now) + æ—¥ (day) = TODAY. The kanji for "now" combined with "sun/day."', radicals:[{k:'ä»Š',m:'now'},{k:'æ—¥',m:'day'}], literal:'The sun of right now â˜€ï¸', hook:'KYOU = today is happening right NOW under the sun!', related:['æ˜æ—¥','æ˜¨æ—¥','æ¯æ—¥'] }},
    { k:'æ˜æ—¥', f:'ã‚ã—ãŸ', r:'ashita', m:'tomorrow', pos:'noun',
      origin:{ pictograph:'æ˜ combines æ—¥ (sun) + æœˆ (moon) â€” the brightness of BOTH sun and moon = tomorrow\'s bright new day coming! æ—¥ (day) again reinforces "day."', radicals:[{k:'æ—¥',m:'sun'},{k:'æœˆ',m:'moon'}], literal:'Sun + Moon together = a new bright day is coming ğŸŒ…', hook:'A-SHITA = "Ah, see you tomorrow!" ã‚ã—ãŸ!', related:['ä»Šæ—¥','æ˜¨æ—¥','æ¥é€±'] }},
  ],
  N4: [
    { k:'é›»è©±', f:'ã§ã‚“ã‚', r:'denwa', m:'telephone', pos:'noun',
      origin:{ pictograph:'é›» shows rain (é›¨) with lightning bolts (é›») â€” electricity from a storm. è©± shows a tongue (èˆŒ) + words (è¨€) = speaking. Together: speaking with electricity!', radicals:[{k:'é›»',m:'electricity'},{k:'è©±',m:'speak'}], literal:'Electricity + Speech = Electric Talking Machine âš¡ğŸ—£ï¸', hook:'DEN-WA: "DEN" like a dragon\'s den of electricity, "WA" like "wah!" you spoke! ã§ã‚“ã‚!', related:['æºå¸¯','ãƒ¡ãƒ¼ãƒ«','é€£çµ¡'] }},
    { k:'å¤©æ°—', f:'ã¦ã‚“ã', r:'tenki', m:'weather', pos:'noun',
      origin:{ pictograph:'å¤© shows a person (å¤§) with a line above their head â€” the sky ABOVE a person. æ°— originally showed steam/vapour rising â€” energy, atmosphere, spirit. Sky energy = weather!', radicals:[{k:'å¤©',m:'sky/heaven'},{k:'æ°—',m:'energy/atmosphere'}], literal:'The energy of the sky = weather â›…', hook:'TEN-KI: "TEN" like heaven, "KI" like energy â€” heavenly energy = today\'s weather!', related:['é›¨','æ™´ã‚Œ','æ°—æ¸©'] }},
    { k:'æ–™ç†', f:'ã‚Šã‚‡ã†ã‚Š', r:'ryouri', m:'cooking / dish', pos:'noun',
      origin:{ pictograph:'æ–™ shows rice (ç±³) being measured (æ–—) â€” measuring ingredients. ç† shows a jade gem being polished â€” bringing out inner beauty. Together: measuring and perfecting food!', radicals:[{k:'æ–™',m:'ingredients'},{k:'ç†',m:'logic/polish'}], literal:'Measuring + Perfecting = Cooking something beautifully ğŸ³', hook:'RYOU-RI: "RYO" like Rio carnival of flavours, "RI" like "really delicious!" ã‚Šã‚‡ã†ã‚Š!', related:['é£Ÿã¹ç‰©','å‘³','ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³'] }},
    { k:'æ—…è¡Œ', f:'ã‚Šã‚‡ã“ã†', r:'ryokou', m:'travel', pos:'noun',
      origin:{ pictograph:'æ—… shows a person (äºº) under a flag on the move â€” a traveller following a route marker. è¡Œ is a crossroads (going). Together: a person moving from place to place following the road!', radicals:[{k:'æ—…',m:'travel/trip'},{k:'è¡Œ',m:'go/travel'}], literal:'Traveller + Road = Journey! âœˆï¸', hook:'RYO-KOU: "Ryo" like your travel backpack, "kou" like GO â€” pack your bag and GO! ã‚Šã‚‡ã“ã†!', related:['æ—…äºº','è¦³å…‰','å¤–å›½'] }},
    { k:'ç·´ç¿’', f:'ã‚Œã‚“ã—ã‚…ã†', r:'renshuu', m:'practice', pos:'noun',
      origin:{ pictograph:'ç·´ shows thread (ç³¸) being pulled through repeatedly â€” refining silk by repeated action. ç¿’ shows a bird (ç¾½) learning to fly â€” a young bird practising flapping. Together: repeated refinement!', radicals:[{k:'ç³¸',m:'thread'},{k:'ç¾½',m:'wings/feathers'}], literal:'Refining thread + Young bird learning to fly = Practice! ğŸ¦', hook:'REN-SHUU: "REN" like training again and again, "SHUU" like "Shoo! Keep practising!" ã‚Œã‚“ã—ã‚…ã†!', related:['å‹‰å¼·','è¨“ç·´','ä¸Šé”'] }},
    { k:'è¦šãˆã‚‹', f:'ãŠã¼ãˆã‚‹', r:'oboeru', m:'to memorise', pos:'verb (ru)',
      origin:{ pictograph:'è¦š shows a roof (å®€) protecting a crossed pattern (çˆ») above an eye (è¦‹) â€” knowledge being seen and protected under a roof in your mind = to remember!', radicals:[{k:'è¦‹',m:'see'},{k:'å®€',m:'roof'}], literal:'Keeping knowledge safe under a mental roof ğŸ§ ', hook:'O-BOE-RU: "OH BOY, I REMEMBER!" â€” say it when you suddenly recall something! ãŠã¼ãˆã‚‹!', related:['å¿˜ã‚Œã‚‹','æ€ã„å‡ºã™','è¨˜æ†¶'] }},
    { k:'å¿˜ã‚Œã‚‹', f:'ã‚ã™ã‚Œã‚‹', r:'wasureru', m:'to forget', pos:'verb (ru)',
      origin:{ pictograph:'å¿˜ combines äº¡ (death/gone) + å¿ƒ (heart/mind) â€” when something dies from your heart/mind, you forget it. Poetic and a little sad!', radicals:[{k:'äº¡',m:'gone/dead'},{k:'å¿ƒ',m:'heart/mind'}], literal:'Something dying from your heart = forgetting ğŸ’”', hook:'WASU-RERU: "WAS-URE" â€” something WAS here, now it\'s URE-levant... I forgot! ã‚ã™ã‚Œã‚‹!', related:['è¦šãˆã‚‹','è¨˜æ†¶','æ€ã„å‡ºã™'] }},
    { k:'è¦ªåˆ‡', f:'ã—ã‚“ã›ã¤', r:'shinsetsu', m:'kind / kindness', pos:'adj (na)',
      origin:{ pictograph:'è¦ª shows a tree (æœ¨) being stood next to and watched (è¦‹) â€” a parent standing close, watching over. åˆ‡ means to cut â€” cutting through with care. Kindness cuts through barriers!', radicals:[{k:'è¦ª',m:'parent/close'},{k:'åˆ‡',m:'cut/sincere'}], literal:'Close + Sincere = Genuine Kindness ğŸ’›', hook:'SHIN-SETSU: "SHIN" like shining heart, "SETSU" like "let\'s" be kind! ã—ã‚“ã›ã¤!', related:['å„ªã—ã„','ä¸å¯§','æ€ã„ã‚„ã‚Š'] }},
  ],
  N3: [
    { k:'ç’°å¢ƒ', f:'ã‹ã‚“ãã‚‡ã†', r:'kankyou', m:'environment', pos:'noun',
      origin:{ pictograph:'ç’° shows jade rings (ç‰) going around in a circle â€” encircling. å¢ƒ shows earth (åœŸ) with a boundary. Together: the circular boundary of the earth around us = environment!', radicals:[{k:'ç‰',m:'jewel/circle'},{k:'åœŸ',m:'earth'},{k:'å¢ƒ',m:'boundary'}], literal:'Circular + Boundary of Earth = The world surrounding us ğŸŒ', hook:'KAN-KYO: "CAN" the environment "GO" (kyou) on? â€” we must protect it! ã‹ã‚“ãã‚‡ã†!', related:['è‡ªç„¶','åœ°çƒ','ç”Ÿæ…‹ç³»'] }},
    { k:'è²¬ä»»', f:'ã›ãã«ã‚“', r:'sekinin', m:'responsibility', pos:'noun',
      origin:{ pictograph:'è²¬ shows a bundle (æœ¿) being piled on a person â€” the burden of obligations piling up. ä»» shows a person (äºº) carrying something â€” bearing a load. Together: bearing the burden you\'re obligated to carry!', radicals:[{k:'æœ¿',m:'thorn/burden'},{k:'äºº',m:'person'}], literal:'A burden being placed on someone who must carry it ğŸ’ª', hook:'SEKI-NIN: "SEEK" your responsibilities, "NIN" like ninja â€” a ninja never avoids duty! ã›ãã«ã‚“!', related:['ç¾©å‹™','å½¹å‰²','è·å‹™'] }},
    { k:'å¯èƒ½æ€§', f:'ã‹ã®ã†ã›ã„', r:'kanousei', m:'possibility', pos:'noun',
      origin:{ pictograph:'å¯ shows a mouth (å£) giving approval â€” possible, permitted. èƒ½ shows a bear (èƒ½) â€” a capable, powerful creature. æ€§ is nature/essence. Together: the capable nature of something being approved = possibility!', radicals:[{k:'å£',m:'mouth'},{k:'èƒ½',m:'ability'},{k:'æ€§',m:'nature'}], literal:'Approval + Capability + Essence = The potential for something to happen âœ¨', hook:'KA-NOU-SEI: "CAN-DO-SAY" â€” if you CAN DO it, SAY yes! It\'s possible! ã‹ã®ã†ã›ã„!', related:['å¯èƒ½','æ©Ÿä¼š','ãƒãƒ£ãƒ³ã‚¹'] }},
    { k:'å½±éŸ¿', f:'ãˆã„ãã‚‡ã†', r:'eikyou', m:'influence / effect', pos:'noun',
      origin:{ pictograph:'å½± shows a shadow (å½¡) cast by the sun through trees (æ™¯) â€” a shadow is the influence of an object on light. éŸ¿ shows a sound wave echoing (éŸ³+é„•) â€” influence echoes out like sound!', radicals:[{k:'æ™¯',m:'scenery/light'},{k:'å½¡',m:'shadow/hair'},{k:'éŸ³',m:'sound'}], literal:'Shadow + Echo = The effect one thing has on another ğŸŒŠ', hook:'EI-KYO: Think of the ripple EFFECT (ãˆã„ãã‚‡ã†) â€” like throwing a stone in water, the influence spreads!', related:['åŠ¹æœ','ä½œç”¨','çµæœ'] }},
    { k:'è¤‡é›‘', f:'ãµãã–ã¤', r:'fukuzatsu', m:'complicated / complex', pos:'adj (na)',
      origin:{ pictograph:'è¤‡ shows a garment (è¡£) doubled (ç•) â€” something layered and overlapping. é›‘ shows a bird (éš¹) among trees (æœ¨) with mixed things (ä¹) â€” chaotic and mixed. Layered chaos = complicated!', radicals:[{k:'è¡£',m:'clothing'},{k:'éš¹',m:'bird'},{k:'æœ¨',m:'tree'}], literal:'Layered clothing + Bird in tangled trees = COMPLICATED! ğŸ¦â€â¬›', hook:'FUKU-ZATSU: "Full of ZEST" â€” complicated things are full of tangled energy! ãµãã–ã¤!', related:['ç°¡å˜','é›£ã—ã„','å˜ç´”'] }},
  ],
  N2: [
    { k:'æ¦‚å¿µ', f:'ãŒã„ã­ã‚“', r:'gainen', m:'concept / notion', pos:'noun',
      origin:{ pictograph:'æ¦‚ shows a wooden measure being levelled off (æœ¨+æ—£) â€” an approximate, levelled understanding. å¿µ shows a heart (å¿ƒ) with now (ä»Š) â€” a thought present in the heart RIGHT NOW. A levelled thought in your heart = concept!', radicals:[{k:'æœ¨',m:'wood'},{k:'å¿ƒ',m:'heart'},{k:'ä»Š',m:'now'}], literal:'An approximate measure held in the heart = a concept ğŸ’­', hook:'GAI-NEN: "GUY + NEN" â€” that guy\'s idea, that notion in his head! ãŒã„ã­ã‚“!', related:['è¦³å¿µ','æ€æƒ³','ç†å¿µ'] }},
    { k:'ç¶­æŒ', f:'ã„ã˜', r:'iji', m:'to maintain', pos:'verb (suru)',
      origin:{ pictograph:'ç¶­ shows thread (ç³¸) tied to a bird (éš¹) â€” holding something in place with thread. æŒ shows a hand (æ‰Œ) holding something â€” gripping. Together: holding and gripping to keep something in place!', radicals:[{k:'ç³¸',m:'thread'},{k:'æ‰Œ',m:'hand'}], literal:'Thread + Grip = Holding something together so it doesn\'t fall apart ğŸ§µ', hook:'I-JI: "EEE-GEE" â€” hold on, MAINTAIN your composure! ã„ã˜!', related:['ä¿æŒ','ç¶™ç¶š','æŒç¶š'] }},
    { k:'é¡•è‘—', f:'ã‘ã‚“ã¡ã‚‡', r:'kencho', m:'conspicuous / remarkable', pos:'adj (na)',
      origin:{ pictograph:'é¡• shows a head (é ) being illuminated (æ˜¾) â€” something standing out visibly. è‘— shows grass (è‰¹) and something being written clearly (è€…) â€” remarkably clear like words on a page.', radicals:[{k:'é ',m:'head/page'},{k:'è‰¹',m:'grass/plant'},{k:'è€…',m:'person/thing'}], literal:'An illuminated head + written clearly = standing out remarkably! ğŸ’¡', hook:'KEN-CHO: "KEN saw CHO-mpsky and was REMARKABLY impressed!" ã‘ã‚“ã¡ã‚‡!', related:['æ˜ç™½','é¡•åœ¨','è‘—å'] }},
    { k:'æŠŠæ¡', f:'ã¯ã‚ã', r:'haaku', m:'to grasp / understand', pos:'verb (suru)',
      origin:{ pictograph:'æŠŠ shows a hand (æ‰Œ) gripping something tightly (å·´ â€” a coiling snake shape). æ¡ shows a hand (æ‰Œ) squeezing (å±‹) â€” the act of tightly gripping. Double hand energy = to truly grasp!', radicals:[{k:'æ‰Œ',m:'hand (x2)'},{k:'å·´',m:'coil/grip'}], literal:'Two hand radicals = gripping tightly with both hands ğŸ¤', hook:'HA-AKU: "HA! I GRASP it now!" â€” that AHA moment of understanding! ã¯ã‚ã!', related:['ç†è§£','èªè­˜','æŒæ¡'] }},
  ],
  N1: [
    { k:'é€¡å·¡', f:'ã—ã‚…ã‚“ã˜ã‚…ã‚“', r:'shunjun', m:'hesitation / wavering', pos:'noun',
      origin:{ pictograph:'é€¡ shows movement (è¾¶) combined with retreating (å¤‹) â€” moving but pulling back. å·¡ shows movement going around (è¾¶+å·›) â€” circling without committing. Pure hesitation in kanji form!', radicals:[{k:'è¾¶',m:'movement'},{k:'å¤‹',m:'retreat'}], literal:'Moving forward + retreating + circling = going nowhere from hesitation! ğŸŒ€', hook:'SHUN-JUN: "SHOULD I? NO! SHOULD I?" â€” the eternal internal debate of hesitation! ã—ã‚…ã‚“ã˜ã‚…ã‚“!', related:['èºŠèº‡','è¿·ã„','å„ªæŸ”ä¸æ–­'] }},
    { k:'çŸ›ç›¾', f:'ã‚€ã˜ã‚…ã‚“', r:'mujun', m:'contradiction', pos:'noun',
      origin:{ pictograph:'This comes from a famous Chinese fable! A salesman boasted his çŸ› (spear) could pierce anything, and his ç›¾ (shield) could block anything. Someone asked: "What happens if your spear hits your shield?" â€” CONTRADICTION born!', radicals:[{k:'çŸ›',m:'spear'},{k:'ç›¾',m:'shield'}], literal:'The ultimate spear vs the ultimate shield â€” they cannot both be true âš”ï¸ğŸ›¡ï¸', hook:'MU-JUN: "MOO! JUNE is contradicting herself again!" ã‚€ã˜ã‚…ã‚“! Think of the spear-shield paradox!', related:['é€†èª¬','ã‚¸ãƒ¬ãƒ³ãƒ','ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹'] }},
    { k:'å¹½ç„', f:'ã‚†ã†ã’ã‚“', r:'yuugen', m:'subtle / profound (aesthetic)', pos:'adj (na)',
      origin:{ pictograph:'å¹½ shows a mountain (å±±) with hidden, dimly-lit recesses (å¹ºå¹º) â€” the mysterious dark corners. ç„ shows a twisted thread going dark â€” deep, mysterious black. Together: the profound beauty found in mystery and shadow!', radicals:[{k:'å±±',m:'mountain'},{k:'å¹º',m:'small/dim'},{k:'ç„',m:'dark/mysterious'}], literal:'Hidden mountain shadows + deep darkness = profound mysterious beauty ğŸŒ™', hook:'YUU-GEN: "YOU" find "GEN"-uine beauty in the unseen â€” that\'s å¹½ç„, the Japanese art of finding magic in subtlety! ã‚†ã†ã’ã‚“!', related:['ä¾˜ã³å¯‚ã³','ã‚‚ã®ã®ã‚ã‚ã‚Œ','é›…'] }},
    { k:'å¿–åº¦', f:'ãã‚“ãŸã', r:'sontaku', m:'reading the air / second-guessing superiors', pos:'noun',
      origin:{ pictograph:'å¿– shows the heart (å¿ƒ) + measuring (å¯¸) â€” measuring with your heart, intuiting what someone feels. åº¦ shows a hand measuring under a roof â€” calculating dimensions. Together: carefully measuring what someone feels without them saying it!', radicals:[{k:'å¿ƒ',m:'heart'},{k:'å¯¸',m:'measure'},{k:'åº¦',m:'degree'}], literal:'Heart-measuring + calculating = figuring out what your boss wants before they say it! ğŸ¯', hook:'SON-TAKU: "SON, TAKE a guess at what I want!" â€” reading between the lines in Japanese workplace culture! ãã‚“ãŸã!', related:['ç©ºæ°—ã‚’èª­ã‚€','å¿–åº¦ã™ã‚‹','é…æ…®'] }},
    { k:'å¤‰é·', f:'ã¸ã‚“ã›ã‚“', r:'hensen', m:'transition / change over time', pos:'noun',
      origin:{ pictograph:'å¤‰ shows a thread being transformed (å¤‰åŒ–) â€” something changing form. é· shows movement (è¾¶) + a high place (è¥¿+å¤§) â€” moving from one high point to another over time. The journey of transformation!', radicals:[{k:'è¾¶',m:'movement'},{k:'å¤‰',m:'change'}], literal:'Change + Moving from peak to peak over time = historical transition ğŸ“œ', hook:'HEN-SEN: "HEN" like CHANGE (å¤‰) and "SEN" like THOUSAND years â€” change over a thousand years! ã¸ã‚“ã›ã‚“!', related:['å¤‰åŒ–','æ¨ç§»','ç§»è¡Œ'] }},
  ]
};

// Fill remaining vocab without origin data using a default
const defaultOrigin = (k) => ({
  pictograph: `${k} has roots in ancient Chinese pictographic script, evolving over centuries into its modern form through gradual simplification.`,
  radicals: [{k: k[0], m:'component'}],
  literal: `The character carries meaning through its visual components combined.`,
  hook: `Break it into parts and create your own visual story to remember it!`,
  related: []
});

// Extend all vocab with default origin if missing
Object.values(vocab).forEach(arr => arr.forEach(w => { if (!w.origin) w.origin = defaultOrigin(w.k); }));

// Add more N4 words â€” all with full rich origin data
const extraN4 = [
  { k:'éŸ³æ¥½', f:'ãŠã‚“ãŒã', r:'ongaku', m:'music', pos:'noun',
    origin:{ pictograph:'éŸ³ shows a mouth (å£) with a sound wave line coming out â€” sound itself! æ¥½ shows strings stretched over a frame (æœ¨) â€” a stringed instrument being played. Sound + instrument = music!', radicals:[{k:'éŸ³',m:'sound'},{k:'æ¥½',m:'music/pleasure'}], literal:'Sound waves + a stringed instrument = Music flowing through the air ğŸµ', hook:'ON-GA-KU: "Oh! Nice! Cool!" â€” that\'s what you say when you hear great music! ãŠã‚“ãŒã!', related:['æ­Œ','æ¥½å™¨','æ¼”å¥'] }},
  { k:'æ˜ ç”»', f:'ãˆã„ãŒ', r:'eiga', m:'movie', pos:'noun',
    origin:{ pictograph:'æ˜  shows the sun (æ—¥) projecting light (å¤®) outward â€” like a projector beam! ç”» shows a field (ç”°) divided by lines â€” a frame, a picture. Light projected into frames = movie!', radicals:[{k:'æ—¥',m:'sun/light'},{k:'ç”»',m:'picture/frame'}], literal:'Projected light + framed pictures = cinema magic ğŸ¬', hook:'EI-GA: "Hey! GAH!" â€” you say "Hey! Gah!" when a plot twist hits in a movie! ãˆã„ãŒ!', related:['æ˜ ç”»é¤¨','ä¿³å„ª','ç›£ç£'] }},
  { k:'ä»•äº‹', f:'ã—ã”ã¨', r:'shigoto', m:'work / job', pos:'noun',
    origin:{ pictograph:'ä»• shows a person (äºº) serving â€” originally "to serve a master." äº‹ shows a hand holding a writing brush (å²) â€” recording things, doing official business. Serving + doing official things = work!', radicals:[{k:'äºº',m:'person'},{k:'äº‹',m:'matter/thing'}], literal:'A servant diligently recording work = your job! ğŸ’¼', hook:'SHI-GO-TO: "She goes to" work every day â€” SHI-GO-TO! ã—ã”ã¨!', related:['åƒã','è·æ¥­','ä¼šç¤¾'] }},
  { k:'æº–å‚™', f:'ã˜ã‚…ã‚“ã³', r:'junbi', m:'preparation', pos:'noun',
    origin:{ pictograph:'æº– shows water (æ°µ) flowing level (éš¼) â€” getting everything level and ready. å‚™ shows a person (äºº) with arrows (å‚™) stored ready to use â€” being armed and prepared!', radicals:[{k:'æ°µ',m:'water'},{k:'äºº',m:'person'},{k:'çŸ¢',m:'arrow'}], literal:'Levelling the water + storing arrows = fully prepared! ğŸ¹', hook:'JUN-BI: "JUNE BE ready!" â€” prepare in June for summer! ã˜ã‚…ã‚“ã³!', related:['ç”¨æ„','æº–å‚™ã™ã‚‹','è¨ˆç”»'] }},
  { k:'éŠã¶', f:'ã‚ãã¶', r:'asobu', m:'to play / hang out', pos:'verb (u)',
    origin:{ pictograph:'éŠ shows movement (è¾¶) with a flag and child (æ–¿) â€” a child wandering freely with a flag, like playing outside! The freedom of movement = to play!', radicals:[{k:'è¾¶',m:'movement'},{k:'å­',m:'child'}], literal:'A child freely roaming and waving a flag = playing! ğŸˆ', hook:'A-SO-BU: "Ah! So BOOM!" â€” you shout "AH SO!" when you find someone to play with! ã‚ãã¶!', related:['æ¥½ã—ã‚€','ã‚²ãƒ¼ãƒ ','éŠåœ’åœ°'] }},
  { k:'åƒã', f:'ã¯ãŸã‚‰ã', r:'hataraku', m:'to work', pos:'verb (u)',
    origin:{ pictograph:'åƒ is a Japanese-made kanji (å’Œè£½æ¼¢å­—)! It combines person (äºº) + move (å‹•) â€” a person in motion, actively doing something. A moving person = working!', radicals:[{k:'äºº',m:'person'},{k:'å‹•',m:'move/motion'}], literal:'A person constantly in motion = working hard! âš™ï¸', hook:'HA-TA-RA-KU: "HIT-A-ROCK-OO!" â€” you hit a rock while working hard! ã¯ãŸã‚‰ã!', related:['ä»•äº‹','åŠ´åƒ','å‹¤ã‚ã‚‹'] }},
  { k:'æ•™ãˆã‚‹', f:'ãŠã—ãˆã‚‹', r:'oshieru', m:'to teach / tell', pos:'verb (ru)',
    origin:{ pictograph:'æ•™ shows an elder (å­) with a stick/rod (æ”µ) â€” an elder instructing a child with a teaching stick. The authority of wisdom being passed down = to teach!', radicals:[{k:'å­',m:'filial piety'},{k:'æ”µ',m:'strike/action'}], literal:'An elder with a teaching rod guiding the next generation ğŸ“š', hook:'O-SHI-E-RU: "Oh! She\'s a RU-ler!" â€” the teacher who rules the class! ãŠã—ãˆã‚‹!', related:['å­¦ã¶','å…ˆç”Ÿ','æˆæ¥­'] }},
  { k:'æ€¥ã', f:'ã„ãã', r:'isogu', m:'to hurry', pos:'verb (u)',
    origin:{ pictograph:'æ€¥ shows a hand (åˆ) gripping a heart (å¿ƒ) from above â€” urgency gripping your chest! When your heart is grabbed, you move fast. Urgency seizing the heart = to hurry!', radicals:[{k:'å¿ƒ',m:'heart'},{k:'åˆ',m:'hand'}], literal:'A hand grabbing your heart with urgency â€” you\'d hurry too! âš¡', hook:'I-SO-GU: "I\'m SO GU-nna be late!" â€” that panic when you\'re running late! ã„ãã!', related:['é€Ÿã„','èµ°ã‚‹','æ€¥ã„ã§'] }},
  { k:'å›°ã‚‹', f:'ã“ã¾ã‚‹', r:'komaru', m:'to be troubled', pos:'verb (u)',
    origin:{ pictograph:'å›° shows a tree (æœ¨) trapped inside a box (å›—) â€” a tree that can\'t grow, confined and stunted. Feeling trapped like a tree in a box = being troubled or stuck!', radicals:[{k:'æœ¨',m:'tree'},{k:'å›—',m:'enclosure/box'}], literal:'A tree imprisoned in a box â€” stuck, can\'t move = troubled! ğŸ˜°', hook:'KO-MA-RU: "Oh COMMA, RU-ined!" â€” a grammar comma that ruins your sentence = total trouble! ã“ã¾ã‚‹!', related:['æ‚©ã‚€','å•é¡Œ','å¤§å¤‰'] }},
  { k:'æ±ºã‚ã‚‹', f:'ãã‚ã‚‹', r:'kimeru', m:'to decide', pos:'verb (ru)',
    origin:{ pictograph:'æ±º shows water (æ°µ) breaking through (å¤¬) a dam â€” the decisive moment when water bursts free. A burst of decisive action = to decide!', radicals:[{k:'æ°µ',m:'water'},{k:'å¤¬',m:'break through'}], literal:'Water bursting through a dam = making a final decision! ğŸ’¥', hook:'KI-ME-RU: "Key ME RU!" â€” use the KEY to open the door = decide and commit! ãã‚ã‚‹!', related:['é¸ã¶','åˆ¤æ–­','æ±ºæ–­'] }},
  { k:'ä¸å¯§', f:'ã¦ã„ã­ã„', r:'teinei', m:'polite / careful', pos:'adj (na)',
    origin:{ pictograph:'ä¸ shows a nail being hammered in carefully â€” precise, exact. å¯§ shows a heart (å¿ƒ) content under a roof â€” peaceful and calm at home. Careful precision + peaceful heart = polite!', radicals:[{k:'ä¸',m:'exact/nail'},{k:'å¿ƒ',m:'heart'},{k:'å®€',m:'roof'}], literal:'Precise nailing + peaceful heart = refined politeness ğŸ', hook:'TEI-NEI: "They\'re NEAT" â€” polite people are always neat and careful! ã¦ã„ã­ã„!', related:['ç¤¼å„€','è¦ªåˆ‡','ãƒãƒŠãƒ¼'] }},
  { k:'å¤§åˆ‡', f:'ãŸã„ã›ã¤', r:'taisetsu', m:'important', pos:'adj (na)',
    origin:{ pictograph:'å¤§ shows a person with arms stretched wide â€” something BIG and grand. åˆ‡ shows a knife (åˆ€) cutting â€” something that cuts to the core. Big + cutting to the core = truly important!', radicals:[{k:'å¤§',m:'big/great'},{k:'åˆ‡',m:'cut/sincere'}], literal:'Great + cutting to the heart = what truly matters â¤ï¸', hook:'TAI-SE-TSU: "TIE it SETS U" â€” tie down what\'s important so it stays! ãŸã„ã›ã¤!', related:['é‡è¦','è²´é‡','å¤§äº‹'] }},
  { k:'é›£ã—ã„', f:'ã‚€ãšã‹ã—ã„', r:'muzukashii', m:'difficult', pos:'adj (i)',
    origin:{ pictograph:'é›£ shows a bird (éš¹) being strangled or caught (ğ¦°©) â€” a bird trapped, struggling to escape. é›£ originally meant "calamity" â€” something hard to escape from. Struggling = difficult!', radicals:[{k:'éš¹',m:'bird'},{k:'ğ¦°©',m:'catch/strangle'}], literal:'A trapped struggling bird = something hard to deal with ğŸ¦', hook:'MU-ZU-KA-SHII: "Moo! Zoo! Got SHEEP!" â€” herding sheep at a zoo is VERY difficult! ã‚€ãšã‹ã—ã„!', related:['æ˜“ã—ã„','å¤§å¤‰','è¤‡é›‘'] }},
  { k:'çã—ã„', f:'ã‚ãšã‚‰ã—ã„', r:'mezurashii', m:'rare', pos:'adj (i)',
    origin:{ pictograph:'ç shows a jade gem (ç‹/ç‰) that is special (ã±) â€” a truly rare precious jewel. Rare gems are the model for rarity itself!', radicals:[{k:'ç‹',m:'king/gem'},{k:'ã±',m:'strange/special'}], literal:'A rare precious gemstone = something you almost never see ğŸ’', hook:'ME-ZU-RA-SHII: "May-ZOO-RA-SHE" â€” maybe the zoo has a rare she-creature! ã‚ãšã‚‰ã—ã„!', related:['ç‰¹åˆ¥','å¸Œå°‘','è²´é‡'] }},
  { k:'æ‚²ã—ã„', f:'ã‹ãªã—ã„', r:'kanashii', m:'sad', pos:'adj (i)',
    origin:{ pictograph:'æ‚² shows the heart (å¿ƒ) at the bottom and é (wrong/not) on top â€” a heart full of "wrongness." When your heart feels things are wrong and broken = sadness!', radicals:[{k:'å¿ƒ',m:'heart'},{k:'é',m:'wrong/not'}], literal:'A heart full of "wrongness" = sadness flooding in ğŸ’§', hook:'KA-NA-SHII: "Can a SHEEP be sad?" â€” even a sheep gets ã‹ãªã—ã„ sometimes! ã‹ãªã—ã„!', related:['æ³£ã','è¾›ã„','å¯‚ã—ã„'] }},
  { k:'é€£çµ¡', f:'ã‚Œã‚“ã‚‰ã', r:'renraku', m:'contact / communication', pos:'noun',
    origin:{ pictograph:'é€£ shows movement (è¾¶) + a cart (è»Š) â€” things following one another in a connected line. çµ¡ shows thread (ç³¸) wrapping around (å„) â€” binding things together. A connected chain of communication = contact!', radicals:[{k:'è¾¶',m:'movement'},{k:'è»Š',m:'cart/vehicle'},{k:'ç³¸',m:'thread'}], literal:'A chain of carts connected by thread = keeping in touch ğŸ“²', hook:'REN-RA-KU: "WHEN? RACK UP" â€” rack up calls to keep in contact! ã‚Œã‚“ã‚‰ã!', related:['é›»è©±','ãƒ¡ãƒ¼ãƒ«','çŸ¥ã‚‰ã›ã‚‹'] }},
];
extraN4.forEach(w => vocab.N4.push(w));

const extraN3 = [
  { k:'ç›®æ¨™', f:'ã‚‚ãã²ã‚‡ã†', r:'mokuhyou', m:'goal / target', pos:'noun',
    origin:{ pictograph:'ç›® is the eye (ç›®) â€” looking and aiming. æ¨™ shows a tree (æœ¨) topped with a marker sign â€” a signpost you\'re aiming for. Your eye fixed on a signpost = your goal!', radicals:[{k:'ç›®',m:'eye'},{k:'æœ¨',m:'tree'},{k:'ç¤º',m:'sign'}], literal:'Eye fixed on a distant signpost = aiming for your goal! ğŸ¯', hook:'MOKU-HYOU: "Mock-YOU" â€” your goal mocks you until you achieve it! ã‚‚ãã²ã‚‡ã†!', related:['ç›®çš„','é”æˆ','å¤¢'] }},
  { k:'ç†ç”±', f:'ã‚Šã‚†ã†', r:'riyuu', m:'reason / cause', pos:'noun',
    origin:{ pictograph:'ç† shows a jade gem (ç‹) being polished (é‡Œ) â€” bringing out the logical inner structure. ç”± shows a vessel with something coming out from the top â€” the source, the origin. Logical source = reason!', radicals:[{k:'ç‹',m:'gem/logic'},{k:'ç”±',m:'origin/source'}], literal:'Polishing out the logic + finding the source = the reason why ğŸ”', hook:'RI-YUU: "REE-YOU" â€” the reason is because of YOU! ã‚Šã‚†ã†!', related:['åŸå› ','ç†è§£','ãªãœ'] }},
  { k:'çµæœ', f:'ã‘ã£ã‹', r:'kekka', m:'result / outcome', pos:'noun',
    origin:{ pictograph:'çµ shows thread (ç³¸) being tied in a knot (å‰) â€” the final binding. æœ shows a tree (æœ¨) with fruit (ç”°) on top â€” the fruit that results from growth. Tying up + bearing fruit = result!', radicals:[{k:'ç³¸',m:'thread'},{k:'æœ¨',m:'tree'},{k:'ç”°',m:'fruit'}], literal:'Thread tied in a knot + tree bearing fruit = the final outcome ğŸ', hook:'KE-KKA: "CHECK! KA-ching!" â€” check the result, and ka-ching! ã‘ã£ã‹!', related:['åŸå› ','æˆæœ','å½±éŸ¿'] }},
  { k:'åˆ¤æ–­', f:'ã¯ã‚“ã ã‚“', r:'handan', m:'judgement / decision', pos:'noun',
    origin:{ pictograph:'åˆ¤ shows a knife (åˆ€) cutting something in half (åŠ) â€” dividing and discriminating. æ–­ shows an axe (æ–¤) cutting threads (ç³¸) â€” cutting off decisively. Cutting + severing = making a judgement!', radicals:[{k:'åˆ€',m:'knife'},{k:'ç³¸',m:'thread'},{k:'æ–¤',m:'axe'}], literal:'A knife splitting things + an axe cutting through = decisive judgement âš–ï¸', hook:'HAN-DAN: "HAN DAN-ces" â€” Han Solo dances when he makes a judgement call! ã¯ã‚“ã ã‚“!', related:['æ±ºã‚ã‚‹','è©•ä¾¡','åˆ¤å®š'] }},
  { k:'è§£æ±ºã™ã‚‹', f:'ã‹ã„ã‘ã¤ã™ã‚‹', r:'kaiketsu suru', m:'to solve', pos:'verb (suru)',
    origin:{ pictograph:'è§£ shows a knife (åˆ€) separating a cow (ç‰›) horn (è§’) â€” cutting apart, loosening a bind. æ±º shows water bursting through a dam. Together: untying the knot and breaking through = to solve!', radicals:[{k:'åˆ€',m:'knife'},{k:'ç‰›',m:'cow'},{k:'æ°µ',m:'water'}], literal:'Cutting apart the tangle + water breaking free = problem solved! ğŸ”“', hook:'KAI-KE-TSU: "KAY! Ke-TCHA!" â€” "Okay! Gotcha!" â€” problem solved! ã‹ã„ã‘ã¤ã™ã‚‹!', related:['å•é¡Œ','å¯¾å‡¦','ç­”ãˆã‚‹'] }},
  { k:'å‚åŠ ã™ã‚‹', f:'ã•ã‚“ã‹ã™ã‚‹', r:'sanka suru', m:'to participate', pos:'verb (suru)',
    origin:{ pictograph:'å‚ shows three stars (å½¡) above a person bowing (å¤§) â€” originally "to visit a shrine or pay respects." åŠ  shows a mouth (å£) adding force (åŠ›) â€” joining in and adding your strength. Visiting + adding force = participating!', radicals:[{k:'å½¡',m:'three stars'},{k:'åŠ›',m:'strength'},{k:'å£',m:'mouth'}], literal:'Bowing to join + adding your strength = getting involved! ğŸ™Œ', hook:'SAN-KA: "SUN-KA-ching!" â€” the sun shines when you join in! ã•ã‚“ã‹ã™ã‚‹!', related:['åŠ ã‚ã‚‹','å‡ºå¸­','å”åŠ›'] }},
  { k:'æ¯”ã¹ã‚‹', f:'ãã‚‰ã¹ã‚‹', r:'kuraberu', m:'to compare', pos:'verb (ru)',
    origin:{ pictograph:'æ¯” shows two people (äºº) standing side by side â€” two things placed next to each other for comparison. The simplest act of measurement: putting things side by side!', radicals:[{k:'äºº',m:'person (x2)'}], literal:'Two people standing next to each other = comparing side by side ğŸ‘¥', hook:'KU-RA-BE-RU: "Kura-BEAR-u" â€” compare two bears, which is bigger? ãã‚‰ã¹ã‚‹!', related:['é•ã„','åŒã˜','å·®'] }},
  { k:'ç¶šã', f:'ã¤ã¥ã', r:'tsuzuku', m:'to continue', pos:'verb (u)',
    origin:{ pictograph:'ç¶š shows thread (ç³¸) being sold/passed on (å£²) â€” thread being continuously extended and passed along. An unbroken thread = continuation!', radicals:[{k:'ç³¸',m:'thread'},{k:'å£²',m:'sell/pass on'}], literal:'Thread that keeps getting passed along = something that goes on and on â¡ï¸', hook:'TSU-ZU-KU: "Zoo-ZOOKU!" â€” the zoo zoo zoo keeps going on! ã¤ã¥ã!', related:['ç¶™ç¶š','ãšã£ã¨','é€£ç¶š'] }},
  { k:'èªã‚ã‚‹', f:'ã¿ã¨ã‚ã‚‹', r:'mitomeru', m:'to recognise / acknowledge', pos:'verb (ru)',
    origin:{ pictograph:'èª shows a word (è¨€) + endure/persevere (å¿) â€” words that take patience and careful discernment. To recognise something takes careful observation and admitting what you see!', radicals:[{k:'è¨€',m:'words'},{k:'å¿',m:'endure/patience'}], literal:'Patient words + careful observation = recognising and admitting the truth ğŸ‘ï¸', hook:'MI-TO-ME-RU: "ME TOO, ME RU!" â€” "Me too!" â€” acknowledging someone else\'s point! ã¿ã¨ã‚ã‚‹!', related:['èªè­˜','å—ã‘å…¥ã‚Œã‚‹','æ‰¿èª'] }},
  { k:'å…·ä½“çš„', f:'ããŸã„ã¦ã', r:'gutaiteki', m:'concrete / specific', pos:'adj (na)',
    origin:{ pictograph:'å…· shows a container (ç›®) with hands (å»¾) â€” holding real physical things. ä½“ is the body (ä½“) â€” tangible, physical existence. çš„ is a target (ç™½+å‹º) â€” pointing precisely. Physical body + aimed at a target = concrete and specific!', radicals:[{k:'å…·',m:'tool/real'},{k:'ä½“',m:'body'},{k:'çš„',m:'target'}], literal:'Real tools + a body + a bullseye = exactly specific! ğŸ¯', hook:'GU-TAI-TEK-I: "GOO-TIE-TECH-ee" â€” GOOD tech is always concrete and specific! ããŸã„ã¦ã!', related:['æŠ½è±¡çš„','æ˜ç¢º','è©³ã—ã„'] }},
  { k:'è‡ªç”±', f:'ã˜ã‚†ã†', r:'jiyuu', m:'freedom', pos:'noun',
    origin:{ pictograph:'è‡ª shows a nose (nose was "self" in old script) â€” literally "oneself." ç”± shows something flowing freely from a vessel â€” the source and flow. Being from oneself, flowing freely = freedom!', radicals:[{k:'è‡ª',m:'self/nose'},{k:'ç”±',m:'origin/flow'}], literal:'Oneself + flowing freely from the source = liberty! ğŸ•Šï¸', hook:'JI-YUU: "GEE! YOU!" â€” "Gee, you\'re FREE!" ã˜ã‚†ã†!', related:['è‡ªç«‹','è§£æ”¾','ç‹¬ç«‹'] }},
  { k:'å³ã—ã„', f:'ãã³ã—ã„', r:'kibishi', m:'strict / harsh', pos:'adj (i)',
    origin:{ pictograph:'å³ shows a mountain (å±±) that is steep and imposing (æ•¢+å£) â€” nature at its most uncompromising and harsh. A steep, demanding mountain face = strictness!', radicals:[{k:'å±±',m:'mountain'},{k:'æ•¢',m:'bold/dare'}], literal:'A harsh, steep mountain face that demands respect ğŸ”ï¸', hook:'KI-BI-SHI-I: "KEY-BEE-SHE" â€” the key to the beehive is SHE, the strict queen bee! ãã³ã—ã„!', related:['å³æ ¼','æ¿€ã—ã„','é›£ã—ã„'] }},
  { k:'ç´°ã‹ã„', f:'ã“ã¾ã‹ã„', r:'komakai', m:'detailed / fine', pos:'adj (i)',
    origin:{ pictograph:'ç´° shows thread (ç³¸) that is tiny (å›Ÿ â€” a fontanelle, small opening) â€” the thinnest, most delicate thread. ç´°ã„ = thin; ç´°ã‹ã„ = made of fine, tiny details!', radicals:[{k:'ç³¸',m:'thread'},{k:'å›Ÿ',m:'small/delicate'}], literal:'The thinnest possible thread = extremely fine and detailed ğŸ§µ', hook:'KO-MA-KA-I: "COMMA-KAI!" â€” so many commas = so much detail! ã“ã¾ã‹ã„!', related:['è©³ã—ã„','ä¸å¯§','ç²¾å¯†'] }},
  { k:'èª²é¡Œ', f:'ã‹ã ã„', r:'kadai', m:'task / issue', pos:'noun',
    origin:{ pictograph:'èª² shows words (è¨€) being tested or assigned (æœ) â€” like assignments being given out, word by word. é¡Œ shows the head/top (é ) of something that must be addressed (æ˜¯). Assigned words + addressing the problem = task!', radicals:[{k:'è¨€',m:'words'},{k:'æœ',m:'result'},{k:'é ',m:'head/top'}], literal:'Words assigned + a problem to address = your task or homework ğŸ“', hook:'KA-DAI: "Car DIE!" â€” the car died = that\'s your problem to solve! ã‹ã ã„!', related:['å•é¡Œ','å®¿é¡Œ','ä»•äº‹'] }},
  { k:'çŠ¶æ³', f:'ã˜ã‚‡ã†ãã‚‡ã†', r:'joukyou', m:'situation / circumstances', pos:'noun',
    origin:{ pictograph:'çŠ¶ shows a dog (çŠ¬) in a specific shape â€” its form, its state. æ³ shows water (æ°µ) going somewhere specific (å…„) â€” the flow and condition of things. The shape of things + how they\'re flowing = situation!', radicals:[{k:'çŠ¬',m:'dog/form'},{k:'æ°µ',m:'water'},{k:'å…„',m:'elder/direction'}], literal:'The shape of things + how they\'re flowing = the current state of affairs ğŸŒŠ', hook:'JO-U-KYO: "SHOW! KYOTO!" â€” show me the situation in Kyoto! ã˜ã‚‡ã†ãã‚‡ã†!', related:['çŠ¶æ…‹','äº‹æƒ…','ç’°å¢ƒ'] }},
];
extraN3.forEach(w => vocab.N3.push(w));

// Extra N2 words â€” full rich origin data
const extraN2 = [
  { k:'æ›–æ˜§', f:'ã‚ã„ã¾ã„', r:'aimai', m:'vague / ambiguous', pos:'adj (na)',
    origin:{ pictograph:'æ›– shows the sun (æ—¥) hidden behind something (æ„›) â€” the sun obscured, giving unclear light. æ˜§ shows the sun (æ—¥) + not yet (æœª) â€” not yet fully bright, still dark. Two "unclear sun" kanji = total ambiguity!', radicals:[{k:'æ—¥',m:'sun'},{k:'æ„›',m:'obscure'},{k:'æœª',m:'not yet'}], literal:'A sun hidden twice over = murky, unclear, impossible to pin down ğŸŒ«ï¸', hook:'AI-MAI: "AY! MY!" â€” "Ay, my answer is... well... kinda... maybe?" Total ambiguity! ã‚ã„ã¾ã„!', related:['æ˜ç¢º','ä¸æ˜','ã¯ã£ãã‚Š'] }},
  { k:'æ„è­˜', f:'ã„ã—ã', r:'ishiki', m:'consciousness / awareness', pos:'noun',
    origin:{ pictograph:'æ„ shows the heart (å¿ƒ) + sound (éŸ³) â€” your inner voice speaking in the heart. è­˜ shows words (è¨€) + a halberd (æˆ ) â€” knowing something with sharp precision. Inner voice + sharp knowing = consciousness!', radicals:[{k:'å¿ƒ',m:'heart'},{k:'éŸ³',m:'sound'},{k:'è¨€',m:'words'}], literal:'Your inner voice cutting sharply through thought = awareness ğŸ§ ', hook:'I-SHI-KI: "E-SHE-KEY" â€” the KEY to awareness is opening your inner self! ã„ã—ã!', related:['ç„¡æ„è­˜','è‡ªè¦š','èªè­˜'] }},
  { k:'ä¸»å¼µ', f:'ã—ã‚…ã¡ã‚‡ã†', r:'shuchou', m:'assertion / claim', pos:'noun',
    origin:{ pictograph:'ä¸» shows a flame on a lamp stand â€” the central, dominant light. å¼µ shows a bow (å¼“) being stretched taut â€” tension, strength, extension. A dominant force stretching outward = making a strong claim!', radicals:[{k:'ä¸»',m:'master/main'},{k:'å¼“',m:'bow'}], literal:'The main flame stretched like a taut bow = a bold assertion ğŸ’ª', hook:'SHU-CHOU: "SHOE-CHOW" â€” stamp your shoe and CHOW down on your argument! ã—ã‚…ã¡ã‚‡ã†!', related:['æ„è¦‹','è­°è«–','åè«–'] }},
  { k:'å‚¾å‘', f:'ã‘ã„ã“ã†', r:'keikou', m:'tendency / trend', pos:'noun',
    origin:{ pictograph:'å‚¾ shows a person (äºº) tilting sideways â€” leaning in one direction. å‘ shows a window opening one way â€” facing a direction. A person leaning + facing = having a tendency toward something!', radicals:[{k:'äºº',m:'person'},{k:'å‘',m:'direction'}], literal:'A person perpetually leaning the same way = a tendency or trend ğŸ“ˆ', hook:'KEI-KOU: "KAY! GO!" â€” always trending the same direction! ã‘ã„ã“ã†!', related:['å‚¾ã','æµè¡Œ','ãƒ‘ã‚¿ãƒ¼ãƒ³'] }},
  { k:'å¦¥å”', f:'ã ãã‚‡ã†', r:'dakyou', m:'compromise', pos:'noun',
    origin:{ pictograph:'å¦¥ shows a woman (å¥³) + hand from above (çˆª) â€” to pacify, to settle. å” shows three people working together â€” combined effort. Settling peacefully + working together = compromise!', radicals:[{k:'å¥³',m:'woman'},{k:'çˆª',m:'hand'},{k:'åŠ›',m:'strength x3'}], literal:'Peaceful settling + three people cooperating = finding the middle ground ğŸ¤', hook:'DA-KYOU: "DA! KYO!" â€” "DA! Let\'s cooperate TODAY!" â€” meeting in the middle! ã ãã‚‡ã†!', related:['æŠ˜ã‚Šåˆã„','èª¿æ•´','å¦¥å”ç‚¹'] }},
  { k:'å…‹æœ', f:'ã“ããµã', r:'kokufuku', m:'to overcome', pos:'verb (suru)',
    origin:{ pictograph:'å…‹ shows a person carrying a heavy load on their head â€” bearing a burden with effort and eventually overcoming it. æœ shows a person bowing and submitting â€” but here YOU make it submit to you!', radicals:[{k:'å',m:'burden'},{k:'å„¿',m:'person'},{k:'æœ',m:'submit'}], literal:'Bearing a load + making it submit = conquering and overcoming! âš”ï¸', hook:'KO-KU-FU-KU: "CONQUER-FUKU!" â€” conquer your weakness with good fortune! ã“ããµã!', related:['ä¹—ã‚Šè¶Šãˆã‚‹','æ‰“ã¡å‹ã¤','é”æˆ'] }},
  { k:'æ‰¹åˆ¤', f:'ã²ã¯ã‚“', r:'hihan', m:'criticism / critique', pos:'noun',
    origin:{ pictograph:'æ‰¹ shows a hand (æ‰Œ) striking and comparing. åˆ¤ shows a knife (åˆ€) cutting things in half (åŠ) â€” dividing, making a decisive cut. Striking comparison + decisive cut = criticism!', radicals:[{k:'æ‰Œ',m:'hand'},{k:'æ¯”',m:'compare'},{k:'åˆ€',m:'knife'}], literal:'A hand comparing + a knife dividing = sharp, decisive criticism âœ‚ï¸', hook:'HI-HAN: "HEE-HAN!" â€” a donkey braying = a critic who never stops! ã²ã¯ã‚“!', related:['æ‰¹è©•','è©•ä¾¡','éé›£'] }},
  { k:'æ ¹æ‹ ', f:'ã“ã‚“ãã‚‡', r:'konkyo', m:'basis / grounds / evidence', pos:'noun',
    origin:{ pictograph:'æ ¹ shows a tree (æœ¨) with its roots (è‰®) â€” the foundation of something. æ‹  shows a hand (æ‰Œ) gripping a perch firmly. Deep roots + firm grip = the solid basis of an argument!', radicals:[{k:'æœ¨',m:'tree'},{k:'è‰®',m:'root'},{k:'æ‰Œ',m:'hand'}], literal:'Tree roots gripped firmly = the solid foundation of a claim ğŸŒ³', hook:'KON-KYO: "CON-KYO!" â€” every argument needs its basis! ã“ã‚“ãã‚‡!', related:['æ ¹æœ¬','ç†ç”±','è¨¼æ‹ '] }},
];
extraN2.forEach(w => vocab.N2.push(w));

// Extra N1 words â€” full rich origin data
const extraN1 = [
  { k:'ç‘£æœ«', f:'ã•ã¾ã¤', r:'samatsu', m:'trivial / petty details', pos:'adj (na)',
    origin:{ pictograph:'ç‘£ shows jade (ç‹) fragmented into tiny pieces â€” precious stone broken into worthless chips. æœ« shows a tree (æœ¨) with emphasis on the TIP â€” the very end, the least important part. Jade dust + tree tips = the most trivial things imaginable!', radicals:[{k:'ç‹',m:'jade'},{k:'æœ¨',m:'tree'},{k:'æœ«',m:'tip/end'}], literal:'Scattered jade dust + tree tips = petty, insignificant trifles ğŸƒ', hook:'SA-MA-TSU: "SAMA-TSU!" â€” even a lord (sama) fusses over tiny (tsu) things! ã•ã¾ã¤!', related:['äº›ç´°','æè‘‰æœ«ç¯€','é‡è¦'] }},
  { k:'æ…Ÿå“­', f:'ã©ã†ã“ã', r:'doukoku', m:'wailing / loud lamenting', pos:'noun',
    origin:{ pictograph:'æ…Ÿ shows the heart (å¿ƒ) being violently shaken (å‹•) â€” an emotion so strong it physically moves you. å“­ shows a mouth (å£) + a dog (çŠ¬) â€” the raw, animal sound of grief, like a howl. A shaken heart + an animal howl = wailing grief!', radicals:[{k:'å¿ƒ',m:'heart'},{k:'å‹•',m:'move'},{k:'å£',m:'mouth'},{k:'çŠ¬',m:'dog'}], literal:'A violently shaken heart + a howling mouth = the deepest, loudest grief ğŸ˜¢', hook:'DOU-KOKU: "DOH! KOKORO!" â€” "DOH! My heart!" â€” the cry of pure raw grief! ã©ã†ã“ã!', related:['å˜†ã','æ‚²å˜†','å·æ³£'] }},
  { k:'è¹‰è·', f:'ã•ãŸ', r:'sata', m:'letting time slip by / stagnation', pos:'noun',
    origin:{ pictograph:'è¹‰ shows a foot (è¶³) slipping â€” your foot sliding, losing ground. è· shows a foot (è¶³) stumbling â€” tripping without going anywhere. Two slipping, stumbling feet = a life spent stagnating!', radicals:[{k:'è¶³',m:'foot (x2)'}], literal:'Two feet slipping and stumbling = watching time pass while going nowhere â³', hook:'SA-TA: "SAY TA-ta!" â€” keep saying goodbye to your opportunities! ã•ãŸ!', related:['æ™‚é–“ã‚’ç„¡é§„ã«ã™ã‚‹','åœæ»','ç©ºç™½'] }},
  { k:'åˆ¹é‚£', f:'ã›ã¤ãª', r:'setsuna', m:'a moment / an instant', pos:'noun',
    origin:{ pictograph:'åˆ¹ shows a knife (åˆ€) next to a tree (æœ¨) â€” cutting something cleanly and instantly. é‚£ is a phonetic Sanskrit import meaning "that." Together the Buddhist term for the smallest unit of time â€” a snap of the fingers!', radicals:[{k:'åˆ€',m:'knife'},{k:'æœ¨',m:'tree'}], literal:'A knife-clean instant = the briefest possible moment âš¡', hook:'SE-TSU-NA: "SET-SU-NA!" â€” set your timer and NA! It\'s already gone! ã›ã¤ãª!', related:['ç¬é–“','ä¸€ç¬','åˆ¹é‚£ä¸»ç¾©'] }},
  { k:'è‘›è—¤', f:'ã‹ã£ã¨ã†', r:'kattou', m:'inner conflict / discord', pos:'noun',
    origin:{ pictograph:'è‘› shows a plant (è‰¹) that creeps and tangles â€” the kudzu vine that wraps around everything. è—¤ shows wisteria, also a climbing vine. Two tangled climbing vines = inner conflict wrapped around your heart!', radicals:[{k:'è‰¹',m:'plant (x2)'}], literal:'Two vines tangled around each other = the inner conflict of two desires ğŸŒ¿', hook:'KA-T-TOU: "CAUGHT-OH!" â€” you\'re CAUGHT between two things! ã‹ã£ã¨ã†!', related:['çŸ›ç›¾','ã‚¸ãƒ¬ãƒ³ãƒ','æ‚©ã¿'] }},
  { k:'è¬™è™š', f:'ã‘ã‚“ãã‚‡', r:'kenkyo', m:'humble / modest', pos:'adj (na)',
    origin:{ pictograph:'è¬™ shows words (è¨€) that are restrained and measured â€” speech that pulls back, does not over-claim. è™š shows a tiger shell with an empty inside â€” an empty vessel, not puffed up. Restrained speech + empty inside = true humility!', radicals:[{k:'è¨€',m:'words'},{k:'è™',m:'tiger'},{k:'ä¸š',m:'empty'}], literal:'Restrained words + an empty vessel = true humble modesty ğŸ™', hook:'KEN-KYO: "KEN is KYO-ol!" â€” Ken is cool because he stays humbly quiet! ã‘ã‚“ãã‚‡!', related:['è¬™éœ','æ§ãˆã‚','å‚²æ…¢'] }},
];
extraN1.forEach(w => vocab.N1.push(w));

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SESSION_SIZE = 15;
let currentLevel = 'N5', currentMode = 'meaning';
let pool = [], qIdx = 0, score = 0, lives = 3, results = [];
let answered = false;
let currentEntry = null;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOME UI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadHomeQuote() {
  const q = animeQuotes[Math.floor(Math.random() * animeQuotes.length)];
  document.getElementById('homeQuoteJP').textContent = q.jp;
  document.getElementById('homeQuoteEN').textContent = q.en;
  document.getElementById('homeQuoteSRC').textContent = q.src;
}

function selectLevel(el) {
  soundClick();
  document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  currentLevel = el.dataset.level;
}

function selectMode(el) {
  soundClick();
  document.querySelectorAll('.mode-pill').forEach(p => p.classList.remove('sel'));
  el.classList.add('sel');
  currentMode = el.dataset.mode;
}

function goHome() {
  showScreen('homeScreen');
  loadHomeQuote();
  initHomeUI();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GAME FLOW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startGame() {
  qIdx = 0; score = 0; lives = 3; results = []; answered = false; _sessionXP = 0;
  pool = shuffle([...vocab[currentLevel]]).slice(0, SESSION_SIZE);

  const lv = currentLevel;
  document.getElementById('progFill').style.background = `linear-gradient(90deg, ${lvlColor[lv]}, #f39c12)`;
  document.getElementById('gtLevel').textContent = `JLPT ${lv}`;
  document.getElementById('gtLevel').style.color = lvlColor[lv];
  document.getElementById('gtRank').textContent = lvlRanks[lv];

  showScreen('gameScreen');
  updateXpHUD();
  renderQ();
}

function nextQ() {
  // Save progress mid-session
  saveInProgressSession(currentLevel, currentMode, pool, qIdx+1, score, lives, results);
  qIdx++;
  if (qIdx >= pool.length || lives <= 0) { endGame(); return; }
  answered = false;
  const card = document.getElementById('qCard');
  card.style.animation = 'none'; void card.offsetWidth;
  card.style.animation = 'fadeUp .4s ease both';
  renderQ();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// QUESTION RENDERING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQ() {
  answered = false;
  currentEntry = pool[qIdx];
  const total = pool.length;
  document.getElementById('gtProg') && (document.getElementById('gtProg') ? null : null);
  document.getElementById('gtScore').textContent = score;
  document.getElementById('gtLives').textContent = 'â¤ï¸'.repeat(Math.max(0,lives)) + 'ğŸ–¤'.repeat(3-Math.max(0,lives));
  document.getElementById('feedback').className = 'feedback';
  document.getElementById('nextBtn').className = 'next-btn';
  document.getElementById('senseiQuote').className = 'sensei-quote';
  document.getElementById('answerArea').innerHTML = '';
  document.getElementById('progFill').style.width = `${(qIdx/total)*100}%`;

  if (currentMode === 'meaning') renderMeaning(currentEntry);
  else if (currentMode === 'reading') renderReading(currentEntry);
  else if (currentMode === 'fill') renderFill(currentEntry);
  else renderFlash(currentEntry);
}

function wordHeader(entry) {
  return `
    <div class="word-header">
      <div class="kanji-display">${entry.k}</div>
      <div class="furigana-display">${entry.f}</div>
      <div class="romaji-display">${entry.r} Â· ${entry.pos}</div>
      <button class="origin-btn" onclick="openOrigin()" title="Kanji Origin">â›©ï¸</button>
    </div>`;
}

function renderMeaning(entry) {
  document.getElementById('qTag').textContent = 'ğŸ“˜ What does this mean?';
  document.getElementById('answerArea').innerHTML = wordHeader(entry) + `<div class="opts-grid" id="optGrid"></div>`;
  const distractors = shuffle(pool.filter(e=>e!==entry)).slice(0,3);
  shuffle([entry,...distractors]).forEach(opt => {
    const btn = document.createElement('button');
    btn.className='opt-btn'; btn.textContent=opt.m;
    btn.onclick=()=>handleMCQ(btn, opt===entry, entry, document.getElementById('optGrid'));
    document.getElementById('optGrid').appendChild(btn);
  });
}

function renderReading(entry) {
  document.getElementById('qTag').textContent = 'ğŸ“– Choose the correct reading';
  document.getElementById('answerArea').innerHTML = wordHeader(entry).replace(entry.f,'???').replace(entry.r,'???') +
    `<div style="font-size:.82rem;font-weight:600;text-align:center;margin-bottom:16px;color:var(--stone)">Which reading is correct?</div>
    <div class="opts-grid" id="optGrid"></div>`;
  const distractors = shuffle(pool.filter(e=>e!==entry)).slice(0,3);
  shuffle([entry,...distractors]).forEach(opt => {
    const btn = document.createElement('button');
    btn.className='opt-btn';
    btn.innerHTML=`${opt.f}<br><small style="font-weight:500;color:#aaa">${opt.r}</small>`;
    btn.onclick=()=>handleMCQ(btn, opt===entry, entry, document.getElementById('optGrid'));
    document.getElementById('optGrid').appendChild(btn);
  });
}

function handleMCQ(btn, correct, entry, grid) {
  if (answered) return;
  answered = true;
  Array.from(grid.querySelectorAll('.opt-btn')).forEach(b=>b.disabled=true);
  if (correct) {
    btn.classList.add('correct');
    const pts = getPoints();
    score += pts; results.push(true);
    soundCorrect();
    showXpPop(pts * 0.5, btn);
    showFeedback(true, `âœ… Correct! <b>${entry.k}</b> = "${entry.m}"`);
  } else {
    btn.classList.add('wrong'); lives--;
    results.push(false);
    soundWrong();
    Array.from(grid.querySelectorAll('.opt-btn')).forEach(b => {
      if (b.textContent===entry.m || b.innerHTML.includes(entry.f)) b.classList.add('correct');
    });
    showFeedback(false, `âŒ Answer: <b>${entry.k}</b> = "${entry.m}"`);
    showSenseiQuote();
  }
  updateHUD();
  updateXpHUD();
  document.getElementById('nextBtn').className = 'next-btn show';
}

function renderFill(entry) {
  document.getElementById('qTag').textContent = 'âœï¸ Type the English meaning';
  document.getElementById('answerArea').innerHTML = wordHeader(entry) + `
    <div class="fill-wrap">
      <input class="fill-inp" id="fillInp" placeholder="Type the meaning in Englishâ€¦" autocomplete="off">
      <button class="fill-sub" onclick="checkFill()">Check âœ“</button>
    </div>`;
  window._fillEntry = entry;
  document.getElementById('fillInp').addEventListener('keydown', e=>{ if(e.key==='Enter') checkFill(); });
  setTimeout(()=>document.getElementById('fillInp').focus(), 100);
}

function checkFill() {
  if (answered) return;
  const entry = window._fillEntry;
  const val = document.getElementById('fillInp').value.trim().toLowerCase();
  const keywords = entry.m.toLowerCase().split(/[\s\/]+/).filter(w=>w.length>2);
  const correct = keywords.some(kw=>val.includes(kw));
  answered = true;
  document.getElementById('fillInp').disabled = true;
  document.querySelector('.fill-sub').disabled = true;
  if (correct) {
    document.getElementById('fillInp').classList.add('correct');
    const pts = getPoints();
    score += pts; results.push(true);
    soundCorrect();
    showXpPop(pts * 0.5);
    showFeedback(true, `âœ… Correct! Full meaning: "${entry.m}"`);
  } else {
    document.getElementById('fillInp').classList.add('wrong');
    lives--; results.push(false);
    soundWrong();
    showFeedback(false, `âŒ The meaning is: <b>"${entry.m}"</b>`);
    showSenseiQuote();
  }
  updateHUD();
  updateXpHUD();
  document.getElementById('nextBtn').className = 'next-btn show';
}

function renderFlash(entry) {
  document.getElementById('qTag').textContent = 'ğŸƒ Tap the card to flip';
  document.getElementById('answerArea').innerHTML = `
    <div class="flashcard-scene" onclick="flipCard()">
      <div class="flashcard" id="flashCard">
        <div class="card-face">
          <div class="kanji-display">${entry.k}</div>
          <div class="furigana-display">${entry.f}</div>
          <div class="romaji-display">${entry.r}</div>
          <div class="flip-hint">Tap to reveal meaning â†“</div>
          <button class="origin-btn" style="position:relative;margin-top:10px" onclick="event.stopPropagation();openOrigin()">â›©ï¸ Origin</button>
        </div>
        <div class="card-face card-back">
          <div style="font-family:'Noto Serif JP',serif;font-size:1rem;color:#99f6e4;margin-bottom:8px">${entry.k}</div>
          <div style="font-size:1.4rem;font-weight:700;margin-bottom:8px">${entry.m}</div>
          <div style="font-size:0.78rem;color:#94a3b8">${entry.pos}</div>
        </div>
      </div>
    </div>
    <div class="flashcard-btns" id="fcBtns" style="display:none">
      <button class="fc-btn fc-miss" onclick="flashAnswer(false)">âœ— Didn't know</button>
      <button class="fc-btn fc-got" onclick="flashAnswer(true)">âœ“ Got it!</button>
    </div>`;
  window._flashEntry = entry;
}

function flipCard() {
  const card = document.getElementById('flashCard');
  card.classList.toggle('flipped');
  if (card.classList.contains('flipped')) document.getElementById('fcBtns').style.display='flex';
}

function flashAnswer(correct) {
  if (answered) return;
  answered = true;
  const entry = window._flashEntry;
  document.querySelectorAll('.fc-btn').forEach(b=>b.disabled=true);
  if (correct) {
    const pts = getPoints();
    score += pts; results.push(true);
    soundCorrect();
    showXpPop(pts * 0.5);
    showFeedback(true, `âœ… ${entry.k} = "${entry.m}"`);
  } else {
    lives--; results.push(false);
    soundWrong();
    showFeedback(false, `ğŸ“– ${entry.k} (${entry.f}) = "${entry.m}"`);
    showSenseiQuote();
  }
  updateHUD();
  updateXpHUD();
  document.getElementById('nextBtn').className = 'next-btn show';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SENSEI WRONG-ANSWER QUOTES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSenseiQuote() {
  const q = senseiQuotes[Math.floor(Math.random() * senseiQuotes.length)];
  document.getElementById('senseiText').textContent = q.text;
  document.getElementById('senseiSrc').textContent = q.src;
  document.getElementById('senseiQuote').className = 'sensei-quote show';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ORIGIN PANEL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openOrigin() {
  const entry = currentEntry;
  if (!entry) return;
  const o = entry.origin;

  document.getElementById('opWord').textContent = entry.k;
  document.getElementById('opReading').textContent = `${entry.f} (${entry.r}) Â· ${entry.pos}`;
  document.getElementById('opPictograph').innerHTML = o.pictograph;
  document.getElementById('opLiteral').innerHTML = o.literal;
  document.getElementById('opHook').innerHTML = o.hook;

  const radEl = document.getElementById('opRadicals');
  radEl.innerHTML = '';
  (o.radicals || []).forEach(r => {
    const pill = document.createElement('div');
    pill.className = 'radical-pill';
    pill.innerHTML = `<span class="rp-kanji">${r.k}</span><span class="rp-mean">${r.m}</span>`;
    radEl.appendChild(pill);
  });

  const relEl = document.getElementById('opRelated');
  relEl.innerHTML = '';
  (o.related || []).forEach(r => {
    const chip = document.createElement('div');
    chip.className = 'related-chip';
    chip.textContent = r;
    relEl.appendChild(chip);
  });

  document.getElementById('originOverlay').classList.add('show');
}

function closeOrigin(e) {
  if (e.target === document.getElementById('originOverlay')) closeOriginBtn();
}
function closeOriginBtn() {
  document.getElementById('originOverlay').classList.remove('show');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EMAIL MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let emailShown = false;
function maybeShowEmail() {
  if (!emailShown && !localStorage.getItem('jlpt_email_shown')) {
    emailShown = true;
    setTimeout(() => document.getElementById('emailModal').classList.add('show'), 800);
  }
}
function handleEmailSignup() {
  localStorage.setItem('jlpt_email_shown', 'true');
  document.getElementById('emailModal').classList.remove('show');
}
function closeEmail() {
  localStorage.setItem('jlpt_email_shown', 'true');
  document.getElementById('emailModal').classList.remove('show');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCORE SCREEN
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function endGame() {
  // Save word progress + streak + XP
  const earned = recordSession(currentLevel, pool, results);
  showScreen('scoreScreen');
  maybeShowEmail();

  const correct = results.filter(Boolean).length;
  const total = results.length;
  const pct = total > 0 ? correct/total : 0;

  let jp, en, sub;
  if (pct===1)     {jp='å®Œç’§ï¼'; en='Perfect Score!';   sub='Flawless. You\'re ready for the real exam!';}
  else if(pct>=.8) {jp='ç´ æ™´ã‚‰ã—ã„ï¼'; en='Excellent!'; sub='Outstanding! Keep this pace and you\'ll pass.';}
  else if(pct>=.6) {jp='è‰¯ã„ï¼'; en='Good Work!';       sub='Solid effort â€” review the ones you missed.';}
  else if(pct>=.4) {jp='é ‘å¼µã‚Œï¼'; en='Keep Going!';    sub='Don\'t stop â€” every attempt makes you stronger.';}
  else             {jp='å¾©ç¿’ï¼'; en='Review Time!';      sub='Start with the basics and build your way up!';}

  document.getElementById('scoreJP').textContent = jp;
  document.getElementById('scoreEN').textContent = en;
  document.getElementById('scoreNum').textContent = correct;
  document.getElementById('scoreDenom').textContent = `/ ${total} correct`;
  document.getElementById('scoreSub').textContent = sub;
  document.getElementById('dotsRow').innerHTML = results.map(r=>`<div class="dot ${r?'hit':'miss'}">${r?'âœ…':'âŒ'}</div>`).join('');

  // XP Summary
  const p = getProgress();
  const prog = getXpProgress(p.totalXP || 0);
  const isPerfect = correct === total && total > 0;
  document.getElementById('sxpTitle').textContent = isPerfect
    ? `ğŸ† Perfect Bonus included!`
    : `${prog.current.badge} ${prog.current.name} â€” ${prog.inRank} / ${prog.next ? prog.rankTotal : 'âˆ'} XP to next rank`;
  document.getElementById('sxpSub').textContent = `Total XP: ${p.totalXP || 0} Â· Streak: ğŸ”¥${p.streak || 0}`;
  document.getElementById('sxpTotal').textContent = `+${earned}`;

  const q = animeQuotes[Math.floor(Math.random() * animeQuotes.length)];
  document.getElementById('sqJP').textContent = q.jp;
  document.getElementById('sqEN').textContent = q.en;
  document.getElementById('sqSRC').textContent = q.src;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPoints() { return {N5:10,N4:15,N3:20,N2:30,N1:50}[currentLevel]||10; }
function updateHUD() {
  document.getElementById('gtScore').textContent = score;
  document.getElementById('gtLives').textContent = 'â¤ï¸'.repeat(Math.max(0,lives)) + 'ğŸ–¤'.repeat(3-Math.max(0,lives));
}
function showFeedback(good, msg) {
  const fb = document.getElementById('feedback');
  fb.className = `feedback show ${good?'good':'bad'}`;
  fb.innerHTML = msg;
  // Add share word button on correct answers
  if (good && currentEntry) {
    const shareBtn = document.createElement('button');
    shareBtn.className = 'share-word-btn';
    shareBtn.innerHTML = 'ğŸ”— Share This Word';
    const entry = currentEntry;
    shareBtn.onclick = () => shareWord(entry.k, entry.f, entry.m);
    fb.appendChild(document.createElement('br'));
    fb.appendChild(shareBtn);
  }
}
function shuffle(arr) {
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
  return a;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FLOATING KANJI CANVAS BACKGROUND
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const kanjiChars = ['æ°´','ç«','å±±','å·','æœ¨','æ—¥','æœˆ','é¢¨','é›¨','æµ·','ç©º','èŠ±','æ˜Ÿ','å¿ƒ','å¤¢','åŠ›','é“','å…‰','å½±','å‰£','é­‚','æ„›','å‹‡','æ™º','æ­¦','å¿','ä¾','é¬¼','é¾','ç¥','æ¼¢','èª','å­—','æœ¬','å­¦','èª­','æ›¸','è©±','è´','è¦‹'];

function initCanvas() {
  const canvas = document.getElementById('kanjiCanvas');
  const ctx = canvas.getContext('2d');
  let W, H, particles = [];

  function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }

  function Particle() {
    this.reset = function() {
      this.x = Math.random() * W;
      this.y = Math.random() * H + H;
      this.size = Math.random() * 28 + 14;
      this.speed = Math.random() * 0.4 + 0.15;
      this.drift = (Math.random() - 0.5) * 0.3;
      this.opacity = Math.random() * 0.6 + 0.2;
      this.char = kanjiChars[Math.floor(Math.random() * kanjiChars.length)];
      this.rotation = (Math.random() - 0.5) * 0.4;
      this.rotSpeed = (Math.random() - 0.5) * 0.003;
    };
    this.reset();
    this.y = Math.random() * H; // start spread across screen
  }

  resize();
  for (let i = 0; i < 28; i++) particles.push(new Particle());

  function draw() {
    ctx.clearRect(0, 0, W, H);
    ctx.font = `bold ${particles[0]?.size || 20}px 'Noto Serif JP', serif`;
    particles.forEach(p => {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rotation);
      ctx.globalAlpha = p.opacity;
      ctx.fillStyle = '#c0392b';
      ctx.font = `bold ${p.size}px 'Noto Serif JP', serif`;
      ctx.fillText(p.char, 0, 0);
      ctx.restore();
      p.y -= p.speed;
      p.x += p.drift;
      p.rotation += p.rotSpeed;
      if (p.y < -60) p.reset();
    });
    requestAnimationFrame(draw);
  }

  window.addEventListener('resize', resize);
  draw();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SOUND ENGINE (Web Audio API â€” no files needed)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let audioCtx = null;
function getAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
function playTone(freq, type, duration, volume = 0.18, delay = 0) {
  try {
    const ctx = getAudio();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.type = type; osc.frequency.value = freq;
    const t = ctx.currentTime + delay;
    gain.gain.setValueAtTime(volume, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + duration);
    osc.start(t); osc.stop(t + duration);
  } catch(e) {}
}
function soundCorrect() {
  playTone(523, 'sine', 0.12, 0.15);       // C5
  playTone(659, 'sine', 0.12, 0.15, 0.09); // E5
  playTone(784, 'sine', 0.18, 0.2, 0.17);  // G5
}
function soundWrong() {
  playTone(220, 'sawtooth', 0.15, 0.12);
  playTone(180, 'sawtooth', 0.15, 0.12, 0.12);
}
function soundLevelUp() {
  [523,587,659,698,784].forEach((f,i) => playTone(f,'sine',0.25,0.18,i*0.1));
}
function soundClick() {
  playTone(440, 'sine', 0.06, 0.07);
}
function soundXP() {
  playTone(880, 'sine', 0.08, 0.1);
  playTone(1047,'sine', 0.08, 0.1, 0.06);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// XP SYSTEM
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const XP_RANKS = [
  { name:'Genin',       badge:'ğŸ¥‹', min:0    },
  { name:'Chunin',      badge:'âš”ï¸', min:200  },
  { name:'Jonin',       badge:'ğŸ—¡ï¸', min:500  },
  { name:'ANBU',        badge:'ğŸ‘ï¸', min:1000 },
  { name:'Kage',        badge:'ğŸŒŸ', min:2000 },
  { name:'Hokage',      badge:'ğŸ¯', min:4000 },
  { name:'Legendary',   badge:'ğŸ‰', min:7000 },
];
const XP_PER_LEVEL = [200, 300, 500, 1000, 2000, 3000, 3000];

function getXpRank(totalXp) {
  let rank = XP_RANKS[0];
  for (const r of XP_RANKS) { if (totalXp >= r.min) rank = r; else break; }
  return rank;
}
function getXpProgress(totalXp) {
  let rankIdx = 0;
  for (let i = 0; i < XP_RANKS.length; i++) { if (totalXp >= XP_RANKS[i].min) rankIdx = i; else break; }
  const current = XP_RANKS[rankIdx];
  const next = XP_RANKS[rankIdx + 1];
  if (!next) return { pct: 100, current, next: null, inRank: totalXp - current.min, rankTotal: 999999 };
  const inRank = totalXp - current.min;
  const rankTotal = next.min - current.min;
  return { pct: Math.round((inRank / rankTotal) * 100), current, next, inRank, rankTotal };
}

function calcSessionXP(results, level) {
  const lvlBonus = { N5:1, N4:1.2, N3:1.5, N2:2, N1:3 };
  const mult = lvlBonus[level] || 1;
  let xp = 0;
  const correct = results.filter(Boolean).length;
  xp += correct * 10 * mult;
  if (correct === results.length && results.length > 0) xp += 50 * mult; // perfect bonus
  return Math.round(xp);
}

let _sessionXP = 0; // XP earned this session

function updateXpHUD() {
  const p = getProgress();
  const totalXp = p.totalXP || 0;
  const prog = getXpProgress(totalXp);
  document.getElementById('xpRankBadge').textContent = prog.current.badge;
  document.getElementById('xpRankName').textContent = prog.current.name;
  document.getElementById('xpLabel').textContent = prog.next
    ? `${prog.inRank} / ${prog.rankTotal} XP`
    : `${totalXp} XP MAX`;
  document.getElementById('xpBarFill').style.width = prog.pct + '%';
  const streak = p.streak || 0;
  document.getElementById('xpStreakDisplay').textContent = streak > 0 ? `ğŸ”¥${streak}` : 'ğŸ”¥0';
}

function showXpPop(amount, el) {
  const pop = document.createElement('div');
  pop.className = 'xp-pop';
  pop.textContent = `+${Math.round(amount)} XP`;
  const rect = (el || document.getElementById('qCard')).getBoundingClientRect();
  pop.style.left = (rect.left + rect.width/2 - 30) + 'px';
  pop.style.top = (rect.top + 60) + 'px';
  document.body.appendChild(pop);
  setTimeout(() => pop.remove(), 1300);
}

function checkRankUp(oldXp, newXp) {
  const oldRank = getXpRank(oldXp);
  const newRank = getXpRank(newXp);
  if (newRank.name !== oldRank.name) {
    soundLevelUp();
    const toast = document.createElement('div');
    toast.className = 'levelup-toast';
    toast.textContent = `${newRank.badge} Rank Up! You are now ${newRank.name}!`;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2700);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PERSISTENCE â€” localStorage helpers (UPDATED with XP)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getProgress() {
  const raw = localStorage.getItem('jlpt_progress');
  const defaults = {
    seenWords: { N5:[], N4:[], N3:[], N2:[], N1:[] },
    streak: 0,
    lastVisit: null,
    totalSessions: 0,
    totalXP: 0,
    savedSession: null
  };
  return raw ? Object.assign(defaults, JSON.parse(raw)) : defaults;
}

function saveProgress(p) {
  localStorage.setItem('jlpt_progress', JSON.stringify(p));
}

function recordSession(lv, wordsStudied, sessionResults) {
  const p = getProgress();
  const today = new Date().toISOString().slice(0,10);
  const yesterday = new Date(Date.now()-86400000).toISOString().slice(0,10);

  // Update streak
  if (p.lastVisit === yesterday) p.streak = (p.streak||0) + 1;
  else if (p.lastVisit !== today) p.streak = 1;
  p.lastVisit = today;
  p.totalSessions = (p.totalSessions||0) + 1;

  // Mark words as seen
  wordsStudied.forEach(w => {
    if (!p.seenWords[lv].includes(w.k)) p.seenWords[lv].push(w.k);
  });

  // Award XP
  const earned = calcSessionXP(sessionResults || [], lv);
  const oldXp = p.totalXP || 0;
  p.totalXP = oldXp + earned;
  _sessionXP = earned;

  p.savedSession = null;
  saveProgress(p);

  // Check rank up after save
  setTimeout(() => checkRankUp(oldXp, p.totalXP), 800);
  return earned;
}

function saveInProgressSession(lv, mode, poolWords, qIdx, score, lives, results) {
  const p = getProgress();
  p.savedSession = { lv, mode, poolKeys: poolWords.map(w=>w.k), qIdx, score, lives, results };
  saveProgress(p);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOME UI â€” welcome back + progress bars
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initHomeUI() {
  const p = getProgress();
  const today = new Date().toISOString().slice(0,10);
  const isReturning = p.lastVisit && p.lastVisit !== today || p.totalSessions > 0;

  // Welcome back banner
  if (isReturning) {
    const wb = document.getElementById('welcomeBack');
    wb.classList.add('show');
    const rank = getXpRank(p.totalXP || 0);
    document.getElementById('wbTitle').textContent = p.streak > 2
      ? `ğŸ”¥ ${p.streak}-day streak â€” keep going!`
      : `Welcome back, ${rank.name}!`;
    const total = Object.values(p.seenWords).reduce((a,b)=>a+b.length,0);
    document.getElementById('wbSub').textContent = `${total} words studied Â· ${p.totalSessions} sessions Â· â­ ${p.totalXP || 0} XP total`;
    document.getElementById('wbStreak').textContent = p.streak > 0 ? `ğŸ”¥${p.streak}` : '';
  }

  // Continue bar â€” if there's a saved mid-session
  if (p.savedSession) {
    const cb = document.getElementById('continueBar');
    cb.classList.add('show');
    const s = p.savedSession;
    document.getElementById('cbTitle').textContent = `ğŸ“š Resume JLPT ${s.lv} â€” ${s.mode} mode`;
    document.getElementById('cbSub').textContent = `Question ${s.qIdx+1} of ${s.poolKeys.length} Â· Score: â­${s.score}`;
  }

  // Progress bars + word counts
  ['N5','N4','N3','N2','N1'].forEach(lv => {
    const seen = p.seenWords[lv]?.length || 0;
    const total = vocab[lv]?.length || 50;
    const pct = Math.min(100, Math.round((seen/total)*100));
    const barEl = document.getElementById(`bar-${lv}`);
    const seenEl = document.getElementById(`seen-${lv}`);
    if (barEl) setTimeout(() => barEl.style.width = pct+'%', 300);
    if (seenEl) seenEl.textContent = `${seen} studied`;
    // Update total count label
    const labels = document.querySelectorAll(`[data-level="${lv}"] .level-stat-label span:last-child`);
    labels.forEach(el => el.textContent = `${total} words`);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONTINUE SESSION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function continueSession() {
  const p = getProgress();
  const s = p.savedSession;
  if (!s) return;

  currentLevel = s.lv;
  currentMode = s.mode;
  qIdx = s.qIdx;
  score = s.score;
  lives = s.lives;
  results = s.results;
  answered = false;

  // Rebuild pool from keys
  const allWords = vocab[currentLevel];
  pool = s.poolKeys.map(k => allWords.find(w=>w.k===k)).filter(Boolean);
  if (pool.length === 0) { startGame(); return; }

  // Update header
  document.getElementById('progFill').style.background = `linear-gradient(90deg, ${lvlColor[currentLevel]}, #f39c12)`;
  document.getElementById('gtLevel').textContent = `JLPT ${currentLevel}`;
  document.getElementById('gtLevel').style.color = lvlColor[currentLevel];
  document.getElementById('gtRank').textContent = lvlRanks[currentLevel];

  // Select matching level card
  document.querySelectorAll('.level-card').forEach(c => {
    c.classList.toggle('selected', c.dataset.level === currentLevel);
  });

  showScreen('gameScreen');
  renderQ();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SHARE SYSTEM
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SITE_URL = window.location.href.split('?')[0];
let _shareText = '';

function openShareModal(text, icon = 'ğŸ“¤', title = 'Share') {
  _shareText = text;
  document.getElementById('shareModalIcon').textContent = icon;
  document.getElementById('shareModalTitle').textContent = title;
  document.getElementById('shareTextPreview').textContent = text;
  document.getElementById('copyLinkBtn').textContent = 'ğŸ”— Copy Link';
  document.getElementById('copyLinkBtn').classList.remove('copied');
  document.getElementById('shareModal').classList.add('show');
}

function closeShareModal(e) {
  if (!e || e.target === document.getElementById('shareModal')) {
    document.getElementById('shareModal').classList.remove('show');
  }
}

function shareApp() {
  const text = `ğŸ‡¯ğŸ‡µ Learn Japanese the anime way â€” JLPT Vocabulary Master is free forever! Quiz, flashcards, and kanji memory hooks for N5 to N1. Try it: ${SITE_URL}`;
  if (navigator.share) {
    navigator.share({ title: 'JLPT Vocabulary Master', text: text, url: SITE_URL }).catch(() => {});
    return;
  }
  openShareModal(text, 'ğŸ”—', 'Share This App');
}

function shareScore() {
  const correct = results.filter(Boolean).length;
  const total = results.length;
  const pct = Math.round((correct / total) * 100);
  const emoji = pct >= 90 ? 'ğŸ†' : pct >= 70 ? 'ğŸŒ' : pct >= 50 ? 'âœ¨' : 'ğŸ“–';
  const text = `${emoji} I scored ${correct}/${total} (${pct}%) on JLPT ${currentLevel} in Vocabulary Master ğŸ‡¯ğŸ‡µğŸ”¥\nCan you beat me? Try it free: ${SITE_URL}`;
  if (navigator.share) {
    navigator.share({ title: 'My JLPT Score', text: text, url: SITE_URL }).catch(() => {});
    return;
  }
  openShareModal(text, emoji, 'Share Your Score');
}

function shareWord(kanji, furigana, meaning) {
  const text = `ğŸ‡¯ğŸ‡µ Just learned ${kanji} (${furigana}) = "${meaning}" on JLPT Vocabulary Master!\nLearn Japanese the anime way ğŸ‘‰ ${SITE_URL}`;
  if (navigator.share) {
    navigator.share({ title: `Japanese Word: ${kanji}`, text: text, url: SITE_URL }).catch(() => {});
    return;
  }
  openShareModal(text, 'ğŸƒ', `Share: ${kanji}`);
}

function shareTo(platform) {
  const encoded = encodeURIComponent(_shareText);
  const urls = {
    twitter:  `https://twitter.com/intent/tweet?text=${encoded}`,
    whatsapp: `https://wa.me/?text=${encoded}`,
    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(SITE_URL)}&quote=${encoded}`,
    linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(SITE_URL)}`,
    reddit:   `https://www.reddit.com/submit?url=${encodeURIComponent(SITE_URL)}&title=${encodeURIComponent('ğŸ‡¯ğŸ‡µ JLPT Vocabulary Master â€” learn Japanese the anime way!')}`
  };
  if (urls[platform]) window.open(urls[platform], '_blank', 'width=620,height=520,noopener');
}

function copyLink() {
  const btn = document.getElementById('copyLinkBtn');
  navigator.clipboard.writeText(SITE_URL).then(() => {
    btn.textContent = 'âœ… Copied!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'ğŸ”— Copy Link';
      btn.classList.remove('copied');
    }, 2500);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadHomeQuote();
initCanvas();
initHomeUI();
</script>
</body>
</html>
